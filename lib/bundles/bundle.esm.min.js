import e from"stream";import t from"http";import r from"url";import n from"https";import i from"zlib";import s from"events";import a from"buffer";import o from"util";function u(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}function c(e,t,r,n,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function a(e){c(s,n,i,a,o,"next",e)}function o(e){c(s,n,i,a,o,"throw",e)}a(void 0)}))}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}function _(e){return"object"==typeof e&&"object"==typeof e.internal_resourceInfo}function y(e){const t=e;return"object"==typeof t&&"object"==typeof t.internal_resourceInfo&&"object"==typeof t.internal_resourceInfo.linkedResources}function m(e){const t=e;return"object"==typeof t.internal_changeLog&&Array.isArray(t.internal_changeLog.additions)&&Array.isArray(t.internal_changeLog.deletions)}class v extends Error{}function w(e){return"string"==typeof e?e:e.value}const j=async(e,t)=>{if("object"==typeof window&&"function"!=typeof require)return await window.fetch(e,t);if("function"!=typeof require){return(0,(await Promise.resolve().then((function(){return rn}))).default)(e,t)}let r;return r=require("cross-fetch"),await r(e,t)};var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function S(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var O=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,R=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,T=/\s|\uFEFF|\xA0/,k=/\r?\n[\x20\x09]+/g,E=/[;,"]/,I=/[;,"]|\s/,N=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,A=1,C=2,P=4;function L(e){return e.replace(R,"")}function $(e){return T.test(e)}function D(e,t){for(;$(e[t]);)t++;return t}function M(e){return I.test(e)||!N.test(e)}class B{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){for(var t=[],r=e.toLowerCase(),n=0;n<this.refs.length;n++)this.refs[n].rel.toLowerCase()===r&&t.push(this.refs[n]);return t}get(e,t){e=e.toLowerCase();for(var r=[],n=0;n<this.refs.length;n++)this.refs[n][e]===t&&r.push(this.refs[n]);return r}set(e){return this.refs.push(e),this}has(e,t){e=e.toLowerCase();for(var r=0;r<this.refs.length;r++)if(this.refs[r][e]===t)return!0;return!1}parse(e,t){e=L(e=(t=t||0)?e.slice(t):e).replace(k,"");for(var r=A,n=e.length,i=(t=0,null);t<n;)if(r===A){if($(e[t])){t++;continue}if("<"!==e[t])throw new Error('Unexpected character "'+e[t]+'" at offset '+t);if(null!=i&&(null!=i.rel?this.refs.push(...B.expandRelations(i)):this.refs.push(i)),-1===(o=e.indexOf(">",t)))throw new Error("Expected end of URI delimiter at offset "+t);i={uri:e.slice(t+1,o)},t=o,r=C,t++}else if(r===C){if($(e[t])){t++;continue}if(";"===e[t])r=P,t++;else{if(","!==e[t])throw new Error('Unexpected character "'+e[t]+'" at offset '+t);r=A,t++}}else{if(r!==P)throw new Error('Unknown parser state "'+r+'"');if(";"===e[t]||$(e[t])){t++;continue}if(-1===(o=e.indexOf("=",t)))throw new Error("Expected attribute delimiter at offset "+t);var s=L(e.slice(t,o)).toLowerCase(),a="";if('"'===e[t=D(e,t=o+1)])for(t++;t<n;){if('"'===e[t]){t++;break}"\\"===e[t]&&t++,a+=e[t],t++}else{for(var o=t+1;!E.test(e[o])&&o<n;)o++;a=e.slice(t,o),t=o}switch(i[s]&&B.isSingleOccurenceAttr(s)||("*"===s[s.length-1]?i[s]=B.parseExtendedValue(a):(a="type"===s?a.toLowerCase():a,null!=i[s]?Array.isArray(i[s])?i[s].push(a):i[s]=[i[s],a]:i[s]=a)),e[t]){case",":r=A;break;case";":r=P}t++}return null!=i&&(null!=i.rel?this.refs.push(...B.expandRelations(i)):this.refs.push(i)),i=null,this}toString(){for(var e=[],t="",r=null,n=0;n<this.refs.length;n++)r=this.refs[n],t=Object.keys(this.refs[n]).reduce((function(e,t){return"uri"===t?e:e+"; "+B.formatAttribute(t,r[t])}),"<"+r.uri+">"),e.push(t);return e.join(", ")}}B.isCompatibleEncoding=function(e){return O.test(e)},B.parse=function(e,t){return(new B).parse(e,t)},B.isSingleOccurenceAttr=function(e){return"rel"===e||"type"===e||"media"===e||"title"===e||"title*"===e},B.isTokenAttr=function(e){return"rel"===e||"type"===e||"anchor"===e},B.escapeQuotes=function(e){return e.replace(/"/g,'\\"')},B.expandRelations=function(e){return e.rel.split(" ").map((function(t){var r=Object.assign({},e);return r.rel=t,r}))},B.parseExtendedValue=function(e){var t=/([^']+)?(?:'([^']+)')?(.+)/.exec(e);return{language:t[2].toLowerCase(),encoding:B.isCompatibleEncoding(t[1])?null:t[1].toLowerCase(),value:B.isCompatibleEncoding(t[1])?decodeURIComponent(t[3]):t[3]}},B.formatExtendedAttribute=function(e,t){var r=(t.encoding||"utf-8").toUpperCase();return e+"="+r+"'"+(t.language||"en")+"'"+(Buffer.isBuffer(t.value)&&B.isCompatibleEncoding(r)?t.value.toString(r):Buffer.isBuffer(t.value)?t.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):encodeURIComponent(t.value))},B.formatAttribute=function(e,t){return Array.isArray(t)?t.map((t=>B.formatAttribute(e,t))).join("; "):"*"===e[e.length-1]||"string"!=typeof t?B.formatExtendedAttribute(e,t):(B.isTokenAttr(e)?t=M(t)?'"'+B.escapeQuotes(t)+'"':B.escapeQuotes(t):M(t)&&(t='"'+(t=(t=encodeURIComponent(t)).replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"))+'"'),e+"="+t)};var F=B;function U(e){var t,r,n;const i=null!==(r=null===(t=e.headers.get("Content-Type"))||void 0===t?void 0:t.split(";"))&&void 0!==r?r:[],s=i.length>0&&["text/turtle","application/ld+json"].includes(i[0]),a={sourceIri:e.url,isRawData:!s,contentType:null!==(n=e.headers.get("Content-Type"))&&void 0!==n?n:void 0,linkedResources:{}},o=e.headers.get("Link");if(o){const e=F.parse(o),t=e.get("rel","acl");1===t.length&&(a.aclUrl=new URL(t[0].uri,a.sourceIri).href),a.linkedResources=e.refs.reduce(((e,t)=>{var r,n;return null!==(r=e[n=t.rel])&&void 0!==r||(e[n]=[]),e[t.rel].push(new URL(t.uri,a.sourceIri).href),e}),a.linkedResources)}const u=e.headers.get("WAC-Allow");return u&&(a.permissions=function(e){function t(e){const t=e.split(" ");return t.includes("write")?{read:t.includes("read"),append:!0,write:!0,control:t.includes("control")}:{read:t.includes("read"),append:t.includes("append"),write:!1,control:t.includes("control")}}function r(e,t){const r=e.split(",").map((e=>e.split("="))).filter((e=>2===e.length&&e[0].trim()===t));if(1!==r.length)return"";const n=r[0][1].trim();return'"'!==n.charAt(0)||'"'!==n.charAt(n.length-1)?"":n.substring(1,n.length-1)}return{user:t(r(e,"user")),public:t(r(e,"public"))}}(u)),a}function q(e){let t;return t="function"==typeof e.slice?Object.assign(e.slice(),Object.assign({},e)):Object.assign({},e),t}function z(e){return!e.ok}const Q="http://www.w3.org/ns/auth/acl#Authorization",G="http://www.w3.org/ns/auth/acl#accessTo",H="http://www.w3.org/ns/auth/acl#agent",W="http://www.w3.org/ns/auth/acl#agentGroup",V="http://www.w3.org/ns/auth/acl#agentClass",J="http://www.w3.org/ns/auth/acl#default",X="http://www.w3.org/ns/auth/acl#defaultForNew",Z="http://www.w3.org/ns/auth/acl#mode",K="http://www.w3.org/ns/auth/acl#origin",Y="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",ee="http://www.w3.org/ns/ldp#BasicContainer",te="http://www.w3.org/ns/ldp#Resource",re="http://www.w3.org/ns/ldp#contains",ne="http://xmlns.com/foaf/0.1/Agent",ie="http://www.w3.org/ns/solid/acp#AccessControlResource",se={fetch:j};async function ae(e,t=Object.assign(Object.assign({},se),{ignoreAuthenticationErrors:!1})){var r;const n=Object.assign(Object.assign({},se),t);return oe(await n.fetch(e,{method:"HEAD"}),{ignoreAuthenticationErrors:null!==(r=t.ignoreAuthenticationErrors)&&void 0!==r&&r})}function oe(e,t={ignoreAuthenticationErrors:!1}){if(z(e)&&(!function(e){return 401===e.status||403===e.status}(e)||!t.ignoreAuthenticationErrors))throw new de(`Fetching the metadata of the Resource at [${e.url}] failed: [${e.status}] [${e.statusText}].`,e);return{internal_resourceInfo:U(e)}}function ue(e){return(_(e)?ce(e):w(e)).endsWith("/")}function ce(e){return _(e)?e.internal_resourceInfo.sourceIri:null}const le=ce;class de extends v{constructor(e,t){super(e),this.response=t}get statusCode(){return this.response.status}get statusText(){return this.response.statusText}}const he={fetch:j},fe=["Slug","If-None-Match","Content-Type"];async function pe(e,t=he){const r=Object.assign(Object.assign({},he),t),n=w(e),i=await r.fetch(n,r.init);if(z(i))throw new de(`Fetching the File failed: [${i.status}] [${i.statusText}].`,i);const s=U(i),a=await i.blob();return Object.assign(a,{internal_resourceInfo:s})}async function be(e,t=he){const r=Object.assign(Object.assign({},he),t),n=_(e)?w(le(e)):w(e),i=await r.fetch(n,Object.assign(Object.assign({},r.init),{method:"DELETE"}));if(z(i))throw new de(`Deleting the file at [${n}] failed: [${i.status}] [${i.statusText}].`,i)}async function ge(e,t,r=he){const n=w(e),i=await async function(e,t,r,n){var i,s;const a=Object.assign(Object.assign({},he),n),o=function(e){if(void 0===e)return{};let t={};!function(e){return Array.isArray(e)}(e)?!function(e){return"function"==typeof e.forEach}(e)?t=e:e.forEach(((e,r)=>{t[r]=e})):e.forEach((([e,r])=>{t[e]=r}));return t}(null!==(s=null===(i=a.init)||void 0===i?void 0:i.headers)&&void 0!==s?s:{});if(u=o,fe.some((e=>void 0!==u[e])))throw new Error(`No reserved header (${fe.join(", ")}) should be set in the optional RequestInit.`);var u;void 0!==a.slug&&(o.Slug=a.slug);o["Content-Type"]=function(e,t){if("string"==typeof t)return t;const r="object"==typeof e&&null!==e&&"string"==typeof e.type&&e.type.length>0?e.type:void 0;return null!=r?r:"application/octet-stream"}(t,n.contentType);const c=w(e);return await a.fetch(c,Object.assign(Object.assign({},a.init),{headers:o,method:r,body:t}))}(n,t,"PUT",r);if(z(i))throw new de(`Overwriting the file at [${n}] failed: [${i.status}] [${i.statusText}].`,i);const s=q(t),a=U(i);return a.sourceIri=n,a.isRawData=!0,Object.assign(s,{internal_resourceInfo:a})}class _e{constructor(e){this.value=e||"b"+ ++_e.nextId}equals(e){return!!e&&e.termType===this.termType&&e.value===this.value}}_e.prototype.termType="BlankNode",_e.nextId=0;var ye=_e;class me{equals(e){return!!e&&e.termType===this.termType}}me.prototype.termType="DefaultGraph",me.prototype.value="";var ve=me;var we=function(e){if(!e)return null;if("BlankNode"===e.termType)return this.blankNode(e.value);if("DefaultGraph"===e.termType)return this.defaultGraph();if("Literal"===e.termType)return this.literal(e.value,e.language||this.namedNode(e.datatype.value));if("NamedNode"===e.termType)return this.namedNode(e.value);if("Quad"===e.termType){const t=this.fromTerm(e.subject),r=this.fromTerm(e.predicate),n=this.fromTerm(e.object),i=this.fromTerm(e.graph);return this.quad(t,r,n,i)}if("Variable"===e.termType)return this.variable(e.value);throw new Error(`unknown termType ${e.termType}`)};class je{constructor(e){this.value=e}equals(e){return!!e&&e.termType===this.termType&&e.value===this.value}}je.prototype.termType="NamedNode";var xe=je;const Se=xe;class Oe{constructor(e,t,r){this.value=e,this.datatype=Oe.stringDatatype,this.language="",t?(this.language=t,this.datatype=Oe.langStringDatatype):r&&(this.datatype=r)}equals(e){return!!e&&e.termType===this.termType&&e.value===this.value&&e.language===this.language&&e.datatype.equals(this.datatype)}}Oe.prototype.termType="Literal",Oe.langStringDatatype=new Se("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),Oe.stringDatatype=new Se("http://www.w3.org/2001/XMLSchema#string");var Re=Oe;const Te=ve;class ke{constructor(e,t,r,n){this.subject=e,this.predicate=t,this.object=r,this.graph=n||new Te}equals(e){return!!e&&("Quad"===e.termType||!e.termType)&&e.subject.equals(this.subject)&&e.predicate.equals(this.predicate)&&e.object.equals(this.object)&&e.graph.equals(this.graph)}}ke.prototype.termType="Quad",ke.prototype.value="";var Ee=ke;class Ie{constructor(e){this.value=e}equals(e){return!!e&&e.termType===this.termType&&e.value===this.value}}Ie.prototype.termType="Variable";const Ne=ye,Ae=we,Ce=Re,Pe=xe,Le=Ee,$e=Ie;const De={namedNode:function(e){return new Pe(e)},blankNode:function(e){return new Ne(e)},literal:function(e,t){return"string"==typeof t?-1===t.indexOf(":")?new Ce(e,t):new Ce(e,null,De.namedNode(t)):new Ce(e,null,t)},variable:function(e){return new $e(e)},defaultGraph:function(){return De.defaultGraphInstance},triple:function(e,t,r){return De.quad(e,t,r)},quad:function(e,t,r,n){return new Le(e,t,r,n||De.defaultGraphInstance)},fromTerm:function(e){return Ae.call(De,e)},fromQuad:function(e){return Ae.call(De,e)},defaultGraphInstance:new ve};var Me=De;function Be(e){return"string"==typeof e||e instanceof String}function Fe(e){if("string"==typeof e)return e;if(!e)return"";if(void 0!==e.id&&"Quad"!==e.termType)return e.id;let t,r,n,i;switch(e.termType){case"NamedNode":return e.value;case"BlankNode":return`_:${e.value}`;case"Variable":return`?${e.value}`;case"DefaultGraph":return"";case"Literal":return e.language?`"${e.value}"@${e.language}`:`"${e.value}"${e.datatype&&"http://www.w3.org/2001/XMLSchema#string"!==e.datatype.value?`^^${e.datatype.value}`:""}`;case"Quad":return t=qe(Fe(e.subject)),r=qe(Fe(e.predicate)),n=qe(Fe(e.object)),i="DefaultGraph"===e.graph.termType?"":` ${Fe(e.graph)}`,`<<${t} ${r} ${n}${i}>>`;default:throw new Error(`Unexpected termType: ${e.termType}`)}}const Ue=/^"(.*".*)(?="[^"]*$)/;function qe(e){return e.replace(Ue,((e,t)=>`"${t.replace(/"/g,'""')}`))}class ze{constructor(e){if(this._size=0,this._graphs=Object.create(null),this._id=0,this._ids=Object.create(null),this._ids["><"]=0,this._entities=Object.create(null),this._quads=new Map,e)for(const t of e)this.add(t)}get size(){let e=this._size;if(null!==e)return e;e=0;const t=this._graphs;let r,n;for(const i in t)for(const s in r=t[i].subjects)for(const t in n=r[s])e+=Object.keys(n[t]).length;return this._size=e,this._size}add(e){let t=Fe(e.subject),r=Fe(e.predicate),n=Fe(e.object);const i=Fe(e.graph);let s=this._graphs[i];s||(s=this._graphs[i]={subjects:{},predicates:{},objects:{}},Object.freeze(s));const a=this._ids,o=this._entities;return t=a[t]||(a[o[++this._id]=t]=this._id),r=a[r]||(a[o[++this._id]=r]=this._id),n=a[n]||(a[o[++this._id]=n]=this._id),this._addToIndex(s.subjects,t,r,n),this._addToIndex(s.predicates,r,n,t),this._addToIndex(s.objects,n,t,r),this._setQuad(t,r,n,i,e),this._size=null,this}delete(e){let t=Fe(e.subject),r=Fe(e.predicate),n=Fe(e.object);const i=Fe(e.graph),s=this._ids,a=this._graphs;let o,u,c;if(!((t=s[t])&&(r=s[r])&&(n=s[n])&&(o=a[i])&&(u=o.subjects[t])&&(c=u[r])&&n in c))return this;for(t in this._removeFromIndex(o.subjects,t,r,n),this._removeFromIndex(o.predicates,r,n,t),this._removeFromIndex(o.objects,n,t,r),null!==this._size&&this._size--,this._deleteQuad(t,r,n,i),o.subjects)return this;return delete a[i],this}has(e){const t=Fe(e.subject),r=Fe(e.predicate),n=Fe(e.object),i=Fe(e.graph),s=this._graphs[i];if(!s)return!1;const a=this._ids;let o,u,c;return!(Be(t)&&!(o=a[t])||Be(r)&&!(u=a[r])||Be(n)&&!(c=a[n]))&&1===this._countInIndex(s.objects,c,o,u)}match(e,t,r,n){return this._createDataset(this._match(e,t,r,n))}[Symbol.iterator](){return this._match()[Symbol.iterator]()}_addToIndex(e,t,r,n){const i=e[t]||(e[t]={}),s=i[r]||(i[r]={}),a=n in s;return a||(s[n]=null),!a}_removeFromIndex(e,t,r,n){const i=e[t],s=i[r];delete s[n];for(const e in s)return;delete i[r];for(const e in i)return;delete e[t]}_findInIndex(e,t,r,n,i,s,a,o,u,c){let l,d,h;t&&((l=e,e={})[t]=l[t]);for(const t in e)if(d=e[t],d){r&&((l=d,d={})[r]=l[r]);for(const e in d)if(h=d[e],h){const r=n?n in h?[n]:[]:Object.keys(h);for(let n=0;n<r.length;n++){const l={[i]:t,[s]:e,[a]:r[n]},d=this._getQuad(l.subject,l.predicate,l.object,o);if(c)c.push(d);else if(u(d))return!0}}}return c}_countInIndex(e,t,r,n){let i,s,a,o=0;t&&((i=e,e={})[t]=i[t]);for(const t in e)if(s=e[t],s){r&&((i=s,s={})[r]=i[r]);for(const e in s)a=s[e],a&&(n?n in a&&o++:o+=Object.keys(a).length)}return o}_getGraphs(e){return Be(e)?{[e]:this._graphs[e]}:this._graphs}_match(e,t,r,n){e=e&&Fe(e),t=t&&Fe(t),r=r&&Fe(r),n=n&&Fe(n);const i=[],s=this._getGraphs(n),a=this._ids;let o,u,c,l;if(Be(e)&&!(u=a[e])||Be(t)&&!(c=a[t])||Be(r)&&!(l=a[r]))return i;for(const e in s)o=s[e],o&&(u?l?this._findInIndex(o.objects,l,u,c,"object","subject","predicate",e,null,i):this._findInIndex(o.subjects,u,c,null,"subject","predicate","object",e,null,i):c?this._findInIndex(o.predicates,c,l,null,"predicate","object","subject",e,null,i):l?this._findInIndex(o.objects,l,null,null,"object","subject","predicate",e,null,i):this._findInIndex(o.subjects,null,null,null,"subject","predicate","object",e,null,i));return i}_getQuad(e,t,r,n){return this._quads.get(this._toId(e,t,r,n))}_setQuad(e,t,r,n,i){this._quads.set(this._toId(e,t,r,n),i)}_deleteQuad(e,t,r,n){this._quads.delete(this._toId(e,t,r,n))}_createDataset(e){return new this.constructor(e)}_toId(e,t,r,n){return`${e}:${t}:${r}:${n}`}}const Qe=Me,Ge=ze;Object.assign({dataset:function(e){return new Ge(e)}},Qe).dataset;const He="https://inrupt.com/.well-known/sdk-local-node/",We=Object.freeze;function Ve(e){return e.substring(0,He.length)===He}function Je(e){return e.substring(He.length)}function Xe(e){return"string"==typeof e&&"_:"===e.substring(0,2)}function Ze(e){return e.substring(2)}function Ke(e){return`_:${e.value}`}const Ye="http://www.w3.org/2001/XMLSchema#boolean",et="http://www.w3.org/2001/XMLSchema#dateTime",tt="http://www.w3.org/2001/XMLSchema#date",rt="http://www.w3.org/2001/XMLSchema#time",nt="http://www.w3.org/2001/XMLSchema#decimal",it="http://www.w3.org/2001/XMLSchema#integer",st="http://www.w3.org/2001/XMLSchema#string",at="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString";function ot(e){return"true"===e||"1"===e||"false"!==e&&"0"!==e&&null}function ut(e){if(!/-?\d{4,}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(Z|(\+|-)\d\d:\d\d)?/.test(e))return null;const[t,r]=e.split("T"),[n,i]="-"===t.charAt(0)?[-1,t.substring(1)]:[1,t],[s,a,o]=i.split("-"),u=Number.parseInt(s,10)*n,c=Number.parseInt(a,10)-1,l=Number.parseInt(o,10),[d,h]=ct(r),[f,p]="string"==typeof h?lt(h):[0,0],[b,g,_]=d.split(":"),y=Number.parseInt(b,10)+f,m=Number.parseInt(g,10)+p,[v,w]=_.split("."),j=Number.parseInt(v,10),x=w?Number.parseInt(w,10):0,S=new Date(Date.UTC(u,c,l,y,m,j,x));return u>=0&&u<100&&S.setUTCFullYear(S.getUTCFullYear()-1900),S}function ct(e){if(e.endsWith("Z"))return[e.substring(0,e.length-1),"Z"];const t=e.split("+"),r=e.split("-");return 1===t.length&&1===r.length?[t[0],void 0]:t.length>r.length?[t[0],"+"+t[1]]:[r[0],"-"+r[1]]}function lt(e){if("Z"===e)return[0,0];const t="+"===e.charAt(0)?1:-1,[r,n]=e.substring(1).split(":");return[Number.parseInt(r,10)*t,Number.parseInt(n,10)*t]}function dt(e){const t=Number.parseFloat(e);return Number.isNaN(t)?null:t}function ht(e){const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}function ft(e){return e.toLowerCase()}function pt(e){return bt(e)&&"NamedNode"===e.termType}function bt(e){return null!==e&&"object"==typeof e&&"string"==typeof e.termType&&"string"==typeof e.value&&"function"==typeof e.equals}function gt(e){return pt(e)&&Ve(e.value)}function _t(e){const t=w(e);if("function"!=typeof URL)return!0;try{new URL(t)}catch(e){return!1}return!0}function yt(e,t){return vt.namedNode(mt(Je(e.value),t))}function mt(e,t){if("function"!=typeof URL)throw new Error("The URL interface is not available, so an IRI cannot be determined.");const r=new URL(t);return r.hash=e,r.href}const vt=Me;function wt(e,t,r={}){var n;if(!["NamedNode","DefaultGraph"].includes(t.graph.termType))throw new Error(`Cannot parse Quads with nodes of type [${t.graph.termType}] as their Graph node.`);const i="DefaultGraph"===t.graph.termType?"default":t.graph.value,s=null!==(n=e.graphs[i])&&void 0!==n?n:{};return We(Object.assign(Object.assign({},e),{graphs:We(Object.assign(Object.assign({},e.graphs),{[i]:jt(s,t,r)}))}))}function jt(e,t,r){var n;if(!["NamedNode","BlankNode"].includes(t.subject.termType))throw new Error(`Cannot parse Quads with nodes of type [${t.subject.termType}] as their Subject node.`);const i="BlankNode"===t.subject.termType?`_:${t.subject.value}`:t.subject.value,s=null!==(n=e[i])&&void 0!==n?n:{type:"Subject",url:i,predicates:{}};return We(Object.assign(Object.assign({},e),{[i]:xt(s,t,r)}))}function xt(e,t,r){return We(Object.assign(Object.assign({},e),{predicates:St(e.predicates,t,r)}))}function St(e,t,r){var n;if(!["NamedNode"].includes(t.predicate.termType))throw new Error(`Cannot parse Quads with nodes of type [${t.predicate.termType}] as their Predicate node.`);const i=t.predicate.value,s=null!==(n=e[i])&&void 0!==n?n:{};return We(Object.assign(Object.assign({},e),{[i]:Ot(s,t,r)}))}function Ot(e,t,r){var n,i,s,a,o,u,c,l;if("NamedNode"===t.object.termType){const r=We([...null!==(n=e.namedNodes)&&void 0!==n?n:[],t.object.value]);return We(Object.assign(Object.assign({},e),{namedNodes:r}))}if("Literal"===t.object.termType){if(t.object.datatype.value===at){const r=t.object.language.toLowerCase(),n=We([...null!==(s=null===(i=e.langStrings)||void 0===i?void 0:i[r])&&void 0!==s?s:[],t.object.value]),o=We(Object.assign(Object.assign({},null!==(a=e.langStrings)&&void 0!==a?a:{}),{[r]:n}));return We(Object.assign(Object.assign({},e),{langStrings:o}))}const r=We([...null!==(u=null===(o=e.literals)||void 0===o?void 0:o[t.object.datatype.value])&&void 0!==u?u:[],t.object.value]),n=We(Object.assign(Object.assign({},null!==(c=e.literals)&&void 0!==c?c:{}),{[t.object.datatype.value]:r}));return We(Object.assign(Object.assign({},e),{literals:n}))}if("BlankNode"===t.object.termType){const n=Rt(t.object,r),i=We([...null!==(l=e.blankNodes)&&void 0!==l?l:[],n]);return We(Object.assign(Object.assign({},e),{blankNodes:i}))}throw new Error(`Objects of type [${t.object.termType}] are not supported.`)}function Rt(e,t){var r,n;if(void 0===(null!==(r=t.chainBlankNodes)&&void 0!==r?r:[]).find((t=>t.equals(e))))return Ke(e);const i=(null!==(n=t.otherQuads)&&void 0!==n?n:[]).filter((t=>t.subject.equals(e))),s=i.filter((e=>!Nt(e.object))).reduce(((e,r)=>{var n;if(!["NamedNode"].includes(r.predicate.termType))throw new Error(`Cannot parse Quads with nodes of type [${r.predicate.termType}] as their Predicate node.`);const i=null!==(n=e[r.predicate.value])&&void 0!==n?n:{};return We(Object.assign(Object.assign({},e),{[r.predicate.value]:Ot(i,r,t)}))}),{}),a=i.filter((e=>Nt(e.object)));return a.reduce(((e,r)=>{var n,i;if(!["NamedNode"].includes(r.predicate.termType))throw new Error(`Cannot parse Quads with nodes of type [${r.predicate.termType}] as their Predicate node.`);const s=null!==(n=e[r.predicate.value])&&void 0!==n?n:{},a=null!==(i=s.blankNodes)&&void 0!==i?i:[];return We(Object.assign(Object.assign({},e),{[r.predicate.value]:Object.assign(Object.assign({},s),{blankNodes:[...a,Rt(r.object,t)]})}))}),s)}function Tt(e){const t=e.map((e=>e.subject)).filter(Nt),r=e.map((e=>e.object)).filter(Nt);const n=[];r.forEach((t=>{n.push(...It(t,e))}));const i=t.concat(r).filter((t=>{if(n.some((e=>e.equals(t))))return!1;const r=e.filter((e=>e.object.equals(t))).map((e=>e.subject));return r.length>0&&(i=r).every((e=>i.every((t=>e.equals(t)))));var i}));return i}function kt(e,t={}){var r;const n=[],i=null!==(r=t.dataFactory)&&void 0!==r?r:Me;return Object.keys(e.graphs).forEach((r=>{const s=e.graphs[r],a="default"===r?i.defaultGraph():i.namedNode(r);Object.keys(s).forEach((e=>{const r=s[e].predicates,o=Xe(e)?i.blankNode(Ze(e)):i.namedNode(e);n.push(...Et(r,o,a,t))}))})),n}function Et(e,t,r,n={}){var i;const s=[],a=null!==(i=n.dataFactory)&&void 0!==i?i:Me;return Object.keys(e).forEach((n=>{var i,o,u,c;const l=a.namedNode(n),d=null!==(i=e[n].langStrings)&&void 0!==i?i:{},h=null!==(o=e[n].namedNodes)&&void 0!==o?o:[],f=null!==(u=e[n].literals)&&void 0!==u?u:{},p=null!==(c=e[n].blankNodes)&&void 0!==c?c:[];Object.keys(f).forEach((e=>{const n=a.namedNode(e);f[e].forEach((e=>{const i=a.literal(e,n);s.push(a.quad(t,l,i,r))}))}));Object.keys(d).forEach((e=>{d[e].forEach((n=>{const i=a.literal(n,e);s.push(a.quad(t,l,i,r))}))})),h.forEach((e=>{const n=a.namedNode(e);s.push(a.quad(t,l,n,r))})),p.forEach((e=>{if(Xe(e)){const n=a.blankNode(Ze(e));s.push(a.quad(t,l,n,r))}else{const n=a.blankNode(),i=a.quad(t,l,n,r),o=Et(e,n,r);s.push(i),s.push(...o)}}))})),s}function It(e,t,r=[]){if(void 0!==r.find((t=>t.equals(e))))return r;const n=t.filter((t=>t.subject.equals(e)&&Nt(t.object))).map((e=>e.object));if(0===n.length)return[];const i=[...r,e],s=n.map((e=>It(e,t,i))),a=[];for(const e of s)a.push(...e);return a}function Nt(e){return"BlankNode"===e.termType}const At=()=>{const e=[],t=[],r=[];return{onQuad:t=>{e.push(t)},onError:e=>{r.push(e)},onComplete:e=>{t.push(e)},parse:async(n,i)=>{(await async function(e){return new((await Pt()).Parser)({format:"text/turtle",baseIRI:e})}(ce(i))).parse(n,((n,i,s)=>{n?r.forEach((e=>e(n))):i?e.forEach((e=>e(i))):t.forEach((e=>e()))}))}}};async function Ct(e){const t=new((await Pt()).Writer)({format:"text/turtle"}),r=e.map((e=>vt.quad(e.subject,e.predicate,e.object,void 0)));t.addQuads(r);const n=new Promise(((e,r)=>{t.end(((t,n)=>{if(t)return r(t);e(n)}))}));return await n}async function Pt(){const e=await Promise.resolve().then((function(){return zu}));return void 0!==e.default?e.default:e}function Lt(e){var t,r,n,i,s,a,o,u;if(pt(e))return`<${e.value}> (URL)`;if(function(e){return bt(e)&&"Literal"===e.termType}(e)){if(!pt(e.datatype))return`[${e.value}] (RDF/JS Literal of unknown type)`;let c;switch(e.datatype.value){case Ye:return c=null!==(r=null===(t=ot(e.value))||void 0===t?void 0:t.valueOf())&&void 0!==r?r:`Invalid data: \`${e.value}\``,c+" (boolean)";case et:return c=null!==(i=null===(n=ut(e.value))||void 0===n?void 0:n.toUTCString())&&void 0!==i?i:`Invalid data: \`${e.value}\``,c+" (datetime)";case nt:return c=null!==(a=null===(s=dt(e.value))||void 0===s?void 0:s.toString())&&void 0!==a?a:`Invalid data: \`${e.value}\``,c+" (decimal)";case it:return c=null!==(u=null===(o=ht(e.value))||void 0===o?void 0:o.toString())&&void 0!==u?u:`Invalid data: \`${e.value}\``,c+" (integer)";case at:return`"${e.value}" (${e.language} string)`;case st:return`"${e.value}" (string)`;default:return`[${e.value}] (RDF/JS Literal of type: \`${e.datatype.value}\`)`}}return"BlankNode"===e.termType?`[${e.value}] (RDF/JS BlankNode)`:"Quad"===e.termType?"??? (nested RDF* Quad)":"Variable"===e.termType?`?${e.value} (RDF/JS Variable)`:e}function $t(e){if(!Wt(e))throw new Xt(e)}function Dt(e,t){const r=m(e)?e.internal_changeLog:{additions:[],deletions:[]},[n,i]=t.filter((e=>!Mt(e))).reduce((([e,t],r)=>void 0!==e.find((e=>e.equals(r)))?[e.filter((e=>!e.equals(r))),t]:[e,t.concat(r)]),[r.additions,r.deletions]);return We(Object.assign(Object.assign({},e),{internal_changeLog:{additions:n,deletions:i}}))}function Mt(e){return"BlankNode"===e.subject.termType||"BlankNode"===e.object.termType}const Bt=function(e,t){var r,n,i;if($t(e),!_t(t))throw new Zt(t);const s=w(t),a=null!==(i=null===(n=null===(r=e.predicates[s])||void 0===r?void 0:r.namedNodes)||void 0===n?void 0:n[0])&&void 0!==i?i:null;return null===a?null:Ve(a)?`#${Je(a)}`:a};function Ft(e,t){var r,n,i;if($t(e),!_t(t))throw new Zt(t);const s=w(t);return null!==(i=null===(n=null===(r=e.predicates[s])||void 0===r?void 0:r.namedNodes)||void 0===n?void 0:n.map((e=>Ve(e)?`#${Je(e)}`:e)))&&void 0!==i?i:[]}const Ut=Ft;function qt(e,t){var r,n;$t(e);const i=function(e,t){return Ut(e,t).map((e=>vt.namedNode(e)))}(e,t),s=function(e,t){var r,n,i,s;if($t(e),!_t(t))throw new Zt(t);const a=w(t);let o=[];const u=null!==(n=null===(r=e.predicates[a])||void 0===r?void 0:r.langStrings)&&void 0!==n?n:{},c=Object.keys(u);for(const e of c){const t=u[e].map((t=>vt.literal(t,e)));o=o.concat(t)}const l=null!==(s=null===(i=e.predicates[a])||void 0===i?void 0:i.literals)&&void 0!==s?s:{},d=Object.keys(l);for(const e of d){const t=l[e],r=vt.namedNode(e),n=t.map((e=>vt.literal(e,r)));o=o.concat(n)}return o}(e,t),a=w(t),o=(null!==(n=null===(r=e.predicates[a])||void 0===r?void 0:r.blankNodes)&&void 0!==n?n:[]).map((e=>{const t=Xe(e)?Ze(e):void 0;return vt.blankNode(t)}));return i.concat(s).concat(o)}function zt(e,t={acceptBlankNodes:!1}){var r;const n=void 0!==t.scope?w(t.scope):"default",i=null!==(r=e.graphs[n])&&void 0!==r?r:{};return Object.values(i).filter((e=>!Xe(e.url)||t.acceptBlankNodes))}function Qt(e,t){var r;const n=Jt(t)&&y(e)?mt(Je(t.url),ce(e)):t.url,i=e.graphs.default,s=We(Object.assign(Object.assign({},i),{[n]:We(Object.assign(Object.assign({},t),{url:n}))})),a=We(Object.assign(Object.assign({},e.graphs),{default:s})),o=vt.namedNode(n),u=null===(r=e.graphs.default[n])||void 0===r?void 0:r.predicates,c=void 0!==u?Et(u,o,vt.defaultGraph()):[],l=Et(t.predicates,o,vt.defaultGraph());return function(e,t){const r=m(e)?e.internal_changeLog:{additions:[],deletions:[]},[n,i]=t.filter((e=>!Mt(e))).reduce((([e,t],r)=>void 0!==t.find((e=>e.equals(r)))?[e,t.filter((e=>!e.equals(r)))]:[e.concat(r),t]),[r.additions,r.deletions]);return We(Object.assign(Object.assign({},e),{internal_changeLog:{additions:n,deletions:i}}))}(Dt(We(Object.assign(Object.assign({},e),{graphs:a})),c),l)}function Gt(e,t){var r;let n;n=pt(t)?t.value:"string"==typeof t?Ve(t)&&y(e)?mt(Je(t),ce(e)):t:Jt(t)?t.url:Vt(t);const i=e.graphs.default,s=Object.assign({},i);delete s[n];const a=We(Object.assign(Object.assign({},e.graphs),{default:We(s)})),o=vt.namedNode(n),u=null===(r=e.graphs.default[n])||void 0===r?void 0:r.predicates,c=void 0!==u?Et(u,o,vt.defaultGraph()):[];return Dt(We(Object.assign(Object.assign({},e),{graphs:a})),c)}function Ht(e={}){var t;if(void 0!==e.url){const t=e.url;if(!_t(t))throw new Yt(t);return We({type:"Subject",predicates:We({}),url:t})}const r=null!==(t=e.name)&&void 0!==t?t:er(),n=`${He}${r}`;return We({type:"Subject",predicates:We({}),url:n})}function Wt(e){return"object"==typeof e&&null!==e&&"string"==typeof e.type&&"Subject"===e.type}const Vt=function(e,t){if(Jt(e)){if(void 0===t)throw new Error("The URL of a Thing that has not been persisted cannot be determined without a base URL.");return mt(Je(e.url),t)}return e.url};function Jt(e){return Ve(e.url)}class Xt extends v{constructor(e){super(`Expected a Thing, but received: [${e}].`),this.receivedValue=e}}class Zt extends v{constructor(e){const t=pt(e)?e.value:e;super(`Expected a valid URL to identify a property, but received: [${t}].`),this.receivedProperty=t}}class Kt extends v{constructor(e){const t=pt(e)?e.value:e;super(`Expected a valid URL value, but received: [${t}].`),this.receivedValue=t}}class Yt extends v{constructor(e){const t=pt(e)?e.value:e;super(`Expected a valid URL to identify a Thing, but received: [${t}].`),this.receivedValue=t}}const er=()=>Date.now().toString()+Math.random().toString().substring("0.".length);function tr(e){const t=new URL(e);return t.hash="",t.href}function rr(){return We({type:"Dataset",graphs:{default:{}}})}async function nr(e,t=se){var r;e=w(e);const n=Object.assign(Object.assign({},se),t),i=Object.keys(null!==(r=t.parsers)&&void 0!==r?r:{}),s=i.length>0?i.join(", "):"text/turtle",a=await n.fetch(e,{headers:{Accept:s}});if(z(a))throw new de(`Fetching the Resource at [${e}] failed: [${a.status}] [${a.statusText}].`,a);const o=await async function(e,t={}){if(z(e))throw new de(`Fetching the SolidDataset at [${e.url}] failed: [${e.status}] [${e.statusText}].`,e);const r=oe(e),n=Object.assign({"text/turtle":At()},t.parsers),i=null!==(s=r.internal_resourceInfo.contentType)&&void 0!==s?s:null;var s;if(null===i)throw new Error(`Could not determine the content type of the Resource at [${ce(r)}].`);const a=i.split(";")[0],o=n[a];if(void 0===o)throw new Error(`The Resource at [${ce(r)}] has a MIME type of [${a}], but the only parsers available are for the following MIME types: [${Object.keys(n).join(", ")}].`);const u=await e.text(),c=new Promise(((e,t)=>{let n=We({graphs:We({default:We({})}),type:"Dataset"});const s=[],a=[];o.onError((e=>{t(new Error(`Encountered an error parsing the Resource at [${ce(r)}] with content type [${i}]: ${e}`))})),o.onQuad((e=>{a.push(e),"BlankNode"===e.subject.termType||"BlankNode"===e.object.termType?s.push(e):n=wt(n,e)})),o.onComplete((async()=>{const t=s.length<=20?Tt(s):[],i=s.filter((e=>t.every((t=>!t.equals(e.subject)))));n=i.reduce(((e,r)=>wt(e,r,{otherQuads:a,chainBlankNodes:t})),n);const o=We(Object.assign(Object.assign({},n),r));e(o)})),o.parse(u,r)}));return await c}(a,t);return o}async function ir(e,t,r=se){e=w(e);const n=Object.assign(Object.assign({},se),r),i=function(e){return m(e)?e:We(Object.assign(Object.assign({},e),{internal_changeLog:{additions:[],deletions:[]}}))}(t),s=ur(i,e)?await async function(e){return{method:"PATCH",body:`${e.internal_changeLog.deletions.length>0?`DELETE DATA {${(await Ct(e.internal_changeLog.deletions.map(dr))).trim()}};`:""} ${e.internal_changeLog.additions.length>0?`INSERT DATA {${(await Ct(e.internal_changeLog.additions.map(dr))).trim()}};`:""}`,headers:{"Content-Type":"application/sparql-update"}}}(i):await async function(e){return{method:"PUT",body:await Ct(kt(e).map(dr)),headers:{"Content-Type":"text/turtle","If-None-Match":"*",Link:`<${te}>; rel="type"`}}}(i),a=await n.fetch(e,s);if(z(a)){const t=ur(i,e)?"The changes that were sent to the Pod are listed below.\n\n"+function(e){if(!_(e))return"This is a newly initialized SolidDataset, so there is no source to compare it to.";if(!m(e)||0===e.internal_changeLog.additions.length&&0===e.internal_changeLog.deletions.length)return`## Changes compared to ${ce(e)}\n\nThis SolidDataset has not been modified since it was fetched from ${ce(e)}.\n`;let t=`## Changes compared to ${ce(e)}\n`;const r=function(e){const t={};return e.internal_changeLog.deletions.forEach((r=>{var n,i,s;const a=gt(r.subject)?yt(r.subject,ce(e)):r.subject;if(!pt(a)||!pt(r.predicate))return;const o=w(a),u=w(r.predicate);null!==(n=t[o])&&void 0!==n||(t[o]={}),null!==(i=(s=t[o])[u])&&void 0!==i||(s[u]={added:[],deleted:[]}),t[o][u].deleted.push(r.object)})),e.internal_changeLog.additions.forEach((r=>{var n,i,s;const a=gt(r.subject)?yt(r.subject,ce(e)):r.subject;if(!pt(a)||!pt(r.predicate))return;const o=w(a),u=w(r.predicate);null!==(n=t[o])&&void 0!==n||(t[o]={}),null!==(i=(s=t[o])[u])&&void 0!==i||(s[u]={added:[],deleted:[]}),t[o][u].added.push(r.object)})),t}(e);return Object.keys(r).forEach((e=>{t+=`\n### Thing: ${e}\n`;const n=r[e];Object.keys(n).forEach((e=>{t+=`\nProperty: ${e}\n`;const r=n[e].deleted,i=n[e].added;r.length>0&&(t+="- Removed:\n",r.forEach((e=>t+=`  - ${Lt(e)}\n`))),i.length>0&&(t+="- Added:\n",i.forEach((e=>t+=`  - ${Lt(e)}\n`)))}))})),t}(i):"The SolidDataset that was sent to the Pod is listed below.\n\n"+function(e){let t="";_(e)?t+=`# SolidDataset: ${ce(e)}\n`:t+="# SolidDataset (no URL yet)\n";const r=zt(e);0===r.length?t+="\n<empty>\n":r.forEach((r=>{t+="\n"+function(e){let t="";Jt(e)?t+=`## Thing (no URL yet â€” identifier: \`#${Je(e.url)}\`)\n`:t+=`## Thing: ${e.url}\n`;const r=Object.keys(e.predicates);if(0===r.length)t+="\n<empty>\n";else for(const n of r)t+=`\nProperty: ${n}\n`,qt(e,n).forEach((e=>{t+=`- ${Lt(e)}\n`}));return t}(r),m(e)&&(t+="\n"+function(e,t){const r=vt.namedNode(t.url),n=e.internal_changeLog.additions.reduce(((e,t)=>t.subject.equals(r)?e+1:e),0),i=e.internal_changeLog.deletions.reduce(((e,t)=>t.subject.equals(r)?e+1:e),0);return`(${1===n?"1 new value added":n+" new values added"} / ${1===i?"1 value removed":i+" values removed"})`}(e,r)+"\n")}));return t}(i);throw new de(`Storing the Resource at [${e}] failed: [${a.status}] [${a.statusText}].\n\n`+t,a)}const o=Object.assign(Object.assign({},U(a)),{isRawData:!1}),u=function(e){const t=ce(e),r=e.graphs.default,n=Object.keys(r).reduce(((e,r)=>{const n=function(e,t){const r=Object.keys(e.predicates).reduce(((e,r)=>{var n;const i=null!==(n=e[r].namedNodes)&&void 0!==n?n:[];if(i.every((e=>!Ve(e))))return e;const s=We(i.map((e=>Ve(e)?`${t}#${Je(e)}`:e))),a=We(Object.assign(Object.assign({},e[r]),{namedNodes:s}));return We(Object.assign(Object.assign({},e),{[r]:a}))}),e.predicates);return We(Object.assign(Object.assign({},e),{predicates:r,url:Ve(e.url)?`${t}#${Je(e.url)}`:e.url}))}(e[r],t),i=Ve(r)?`${t}#${Je(r)}`:r,s=Object.assign({},e);return delete s[r],s[i]=n,We(s)}),r),i=We(Object.assign(Object.assign({},e.graphs),{default:n}));return We(Object.assign(Object.assign({},e),{graphs:i}))}(We(Object.assign(Object.assign({},t),{internal_changeLog:{additions:[],deletions:[]},internal_resourceInfo:o})));return u}async function sr(e,t=se){var r;e=(e=w(e)).endsWith("/")?e:e+"/";const n=Object.assign(Object.assign({},se),t),i=await n.fetch(e,{method:"PUT",body:n.initialContent?await Ct(kt(n.initialContent).map(dr)):void 0,headers:{Accept:"text/turtle","Content-Type":"text/turtle","If-None-Match":"*",Link:`<${ee}>; rel="type"`}});if(z(i)){if(409===i.status&&"Conflict"===i.statusText&&(await i.text()).trim()===ar)return or(e,t);const r=void 0===n.initialContent?"empty":"non-empty";throw new de(`Creating the ${r} Container at [${e}] failed: [${i.status}] [${i.statusText}].`,i)}const s=U(i);return We(Object.assign(Object.assign({},null!==(r=t.initialContent)&&void 0!==r?r:rr()),{internal_changeLog:{additions:[],deletions:[]},internal_resourceInfo:s}))}const ar="Can't write file: PUT not supported on containers, use POST instead",or=async(e,t)=>{e=w(e);const r=Object.assign(Object.assign({},se),t);let n;try{n=await ae(e,t)}catch(e){if(!(e instanceof de)||404!==e.statusCode)throw e}if(void 0!==n)throw new Error(`The Container at [${e}] already exists, and therefore cannot be created again.`);const i=e+".dummy",s=await r.fetch(i,{method:"PUT",headers:{Accept:"text/turtle","Content-Type":"text/turtle"}});if(z(s))throw new de(`Creating the empty Container at [${e}] failed: [${s.status}] [${s.statusText}].`,s);await r.fetch(i,{method:"DELETE"});const a=U(await r.fetch(e,{method:"HEAD"}));return We(Object.assign(Object.assign({},rr()),{internal_changeLog:{additions:[],deletions:[]},internal_resourceInfo:a}))};function ur(e,t){return m(e)&&_(e)&&"string"==typeof e.internal_resourceInfo.sourceIri&&function(e,t){return tr(e.internal_resourceInfo.sourceIri)===tr(t)}(e,t)}async function cr(e,t=se){const r=_(e)?w(ce(e)):w(e);if(!ue(e))throw new Error(`You're trying to delete the Container at [${r}], but Container URLs should end in a \`/\`. Are you sure this is a Container?`);const n=Object.assign(Object.assign({},se),t),i=await n.fetch(r,{method:"DELETE"});if(z(i))throw new de(`Deleting the Container at [${r}] failed: [${i.status}] [${i.statusText}].`,i)}function lr(e){const t=function(e,t,r={}){var n;if(!_t(t))throw new Yt(t);const i=void 0!==r.scope?w(r.scope):"default",s=null!==(n=e.graphs[i])&&void 0!==n?n:{},a=w(t),o=s[Ve(a)&&y(e)?mt(Je(a),ce(e)):a];return void 0===o?null:o}(e,ce(e));return null!==t?Ut(t,re):[]}function dr(e){const t=pt(e.subject)?hr(e.subject):e.subject,r=pt(e.object)?hr(e.object):e.object;return vt.quad(t,e.predicate,r,e.graph)}function hr(e){return Ve(e.value)?vt.namedNode("#"+Je(e.value)):e}var fr={exports:{}};const pr=e.Readable,br=Symbol("buffer"),gr=Symbol("type");class _r{constructor(){this[gr]="";const e=arguments[0],t=arguments[1],r=[];let n=0;if(e){const t=e,i=Number(t.length);for(let e=0;e<i;e++){const i=t[e];let s;s=i instanceof Buffer?i:ArrayBuffer.isView(i)?Buffer.from(i.buffer,i.byteOffset,i.byteLength):i instanceof ArrayBuffer?Buffer.from(i):i instanceof _r?i[br]:Buffer.from("string"==typeof i?i:String(i)),n+=s.length,r.push(s)}}this[br]=Buffer.concat(r);let i=t&&void 0!==t.type&&String(t.type).toLowerCase();i&&!/[^\u0020-\u007E]/.test(i)&&(this[gr]=i)}get size(){return this[br].length}get type(){return this[gr]}text(){return Promise.resolve(this[br].toString())}arrayBuffer(){const e=this[br],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new pr;return e._read=function(){},e.push(this[br]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],r=arguments[1];let n,i;n=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),i=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e);const s=Math.max(i-n,0),a=this[br].slice(n,n+s),o=new _r([],{type:arguments[2]});return o[br]=a,o}}function yr(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}let mr;Object.defineProperties(_r.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(_r.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),yr.prototype=Object.create(Error.prototype),yr.prototype.constructor=yr,yr.prototype.name="FetchError";try{mr=require("encoding").convert}catch(e){}const vr=Symbol("Body internals"),wr=e.PassThrough;function jr(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.size;let s=void 0===i?0:i;var a=n.timeout;let o=void 0===a?0:a;null==t?t=null:Sr(t)?t=Buffer.from(t.toString()):Or(t)||Buffer.isBuffer(t)||("[object ArrayBuffer]"===Object.prototype.toString.call(t)?t=Buffer.from(t):ArrayBuffer.isView(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof e||(t=Buffer.from(String(t)))),this[vr]={body:t,disturbed:!1,error:null},this.size=s,this.timeout=o,t instanceof e&&t.on("error",(function(e){const t="AbortError"===e.name?e:new yr(`Invalid response body while trying to fetch ${r.url}: ${e.message}`,"system",e);r[vr].error=t}))}function xr(){var t=this;if(this[vr].disturbed)return jr.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[vr].disturbed=!0,this[vr].error)return jr.Promise.reject(this[vr].error);let r=this.body;if(null===r)return jr.Promise.resolve(Buffer.alloc(0));if(Or(r)&&(r=r.stream()),Buffer.isBuffer(r))return jr.Promise.resolve(r);if(!(r instanceof e))return jr.Promise.resolve(Buffer.alloc(0));let n=[],i=0,s=!1;return new jr.Promise((function(e,a){let o;t.timeout&&(o=setTimeout((function(){s=!0,a(new yr(`Response timeout while trying to fetch ${t.url} (over ${t.timeout}ms)`,"body-timeout"))}),t.timeout)),r.on("error",(function(e){"AbortError"===e.name?(s=!0,a(e)):a(new yr(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e))})),r.on("data",(function(e){if(!s&&null!==e){if(t.size&&i+e.length>t.size)return s=!0,void a(new yr(`content size at ${t.url} over limit: ${t.size}`,"max-size"));i+=e.length,n.push(e)}})),r.on("end",(function(){if(!s){clearTimeout(o);try{e(Buffer.concat(n,i))}catch(e){a(new yr(`Could not create Buffer from response body for ${t.url}: ${e.message}`,"system",e))}}}))}))}function Sr(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function Or(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function Rr(t){let r,n,i=t.body;if(t.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof e&&"function"!=typeof i.getBoundary&&(r=new wr,n=new wr,i.pipe(r),i.pipe(n),t[vr].body=r,i=n),i}function Tr(t){return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":Sr(t)?"application/x-www-form-urlencoded;charset=UTF-8":Or(t)?t.type||null:Buffer.isBuffer(t)||"[object ArrayBuffer]"===Object.prototype.toString.call(t)||ArrayBuffer.isView(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:t instanceof e?null:"text/plain;charset=UTF-8"}function kr(e){const t=e.body;return null===t?0:Or(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}jr.prototype={get body(){return this[vr].body},get bodyUsed(){return this[vr].disturbed},arrayBuffer(){return xr.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return xr.call(this).then((function(t){return Object.assign(new _r([],{type:e.toLowerCase()}),{[br]:t})}))},json(){var e=this;return xr.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return jr.Promise.reject(new yr(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return xr.call(this).then((function(e){return e.toString()}))},buffer(){return xr.call(this)},textConverted(){var e=this;return xr.call(this).then((function(t){return function(e,t){if("function"!=typeof mr)throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=t.get("content-type");let n,i,s="utf-8";r&&(n=/charset=([^;]*)/i.exec(r));i=e.slice(0,1024).toString(),!n&&i&&(n=/<meta.+?charset=(['"])(.+?)\1/i.exec(i));!n&&i&&(n=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(i),n||(n=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(i),n&&n.pop()),n&&(n=/charset=(.*)/i.exec(n.pop())));!n&&i&&(n=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(i));n&&(s=n.pop(),"gb2312"!==s&&"gbk"!==s||(s="gb18030"));return mr(e,"UTF-8",s).toString()}(t,e.headers)}))}},Object.defineProperties(jr.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),jr.mixIn=function(e){for(const t of Object.getOwnPropertyNames(jr.prototype))if(!(t in e)){const r=Object.getOwnPropertyDescriptor(jr.prototype,t);Object.defineProperty(e,t,r)}},jr.Promise=global.Promise;const Er=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,Ir=/[^\t\x20-\x7e\x80-\xff]/;function Nr(e){if(e=`${e}`,Er.test(e)||""===e)throw new TypeError(`${e} is not a legal HTTP header name`)}function Ar(e){if(e=`${e}`,Ir.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function Cr(e,t){t=t.toLowerCase();for(const r in e)if(r.toLowerCase()===t)return r}const Pr=Symbol("map");class Lr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[Pr]=Object.create(null),e instanceof Lr){const t=e.raw(),r=Object.keys(t);for(const e of r)for(const r of t[e])this.append(e,r)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const r=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(const e of r){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const r=e[t];this.append(t,r)}}}}get(e){Nr(e=`${e}`);const t=Cr(this[Pr],e);return void 0===t?null:this[Pr][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=$r(this),n=0;for(;n<r.length;){var i=r[n];const s=i[0],a=i[1];e.call(t,a,s,this),r=$r(this),n++}}set(e,t){t=`${t}`,Nr(e=`${e}`),Ar(t);const r=Cr(this[Pr],e);this[Pr][void 0!==r?r:e]=[t]}append(e,t){t=`${t}`,Nr(e=`${e}`),Ar(t);const r=Cr(this[Pr],e);void 0!==r?this[Pr][r].push(t):this[Pr][e]=[t]}has(e){return Nr(e=`${e}`),void 0!==Cr(this[Pr],e)}delete(e){Nr(e=`${e}`);const t=Cr(this[Pr],e);void 0!==t&&delete this[Pr][t]}raw(){return this[Pr]}keys(){return Mr(this,"key")}values(){return Mr(this,"value")}[Symbol.iterator](){return Mr(this,"key+value")}}function $r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const r=Object.keys(e[Pr]).sort();return r.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[Pr][t].join(", ")}:function(t){return[t.toLowerCase(),e[Pr][t].join(", ")]})}Lr.prototype.entries=Lr.prototype[Symbol.iterator],Object.defineProperty(Lr.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Lr.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const Dr=Symbol("internal");function Mr(e,t){const r=Object.create(Br);return r[Dr]={target:e,kind:t,index:0},r}const Br=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==Br)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[Dr];const t=e.target,r=e.kind,n=e.index,i=$r(t,r);return n>=i.length?{value:void 0,done:!0}:(this[Dr].index=n+1,{value:i[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function Fr(e){const t=Object.assign({__proto__:null},e[Pr]),r=Cr(e[Pr],"Host");return void 0!==r&&(t[r]=t[r][0]),t}Object.defineProperty(Br,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const Ur=Symbol("Response internals"),qr=t.STATUS_CODES;class zr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};jr.call(this,e,t);const r=t.status||200,n=new Lr(t.headers);if(null!=e&&!n.has("Content-Type")){const t=Tr(e);t&&n.append("Content-Type",t)}this[Ur]={url:t.url,status:r,statusText:t.statusText||qr[r],headers:n,counter:t.counter}}get url(){return this[Ur].url||""}get status(){return this[Ur].status}get ok(){return this[Ur].status>=200&&this[Ur].status<300}get redirected(){return this[Ur].counter>0}get statusText(){return this[Ur].statusText}get headers(){return this[Ur].headers}clone(){return new zr(Rr(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}jr.mixIn(zr.prototype),Object.defineProperties(zr.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(zr.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const Qr=Symbol("Request internals"),Gr=r.parse,Hr=r.format,Wr="destroy"in e.Readable.prototype;function Vr(e){return"object"==typeof e&&"object"==typeof e[Qr]}class Jr{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Vr(e)?t=Gr(e.url):(t=e&&e.href?Gr(e.href):Gr(`${e}`),e={});let n=r.method||e.method||"GET";if(n=n.toUpperCase(),(null!=r.body||Vr(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw new TypeError("Request with GET/HEAD method cannot have body");let i=null!=r.body?r.body:Vr(e)&&null!==e.body?Rr(e):null;jr.call(this,i,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const s=new Lr(r.headers||e.headers||{});if(null!=i&&!s.has("Content-Type")){const e=Tr(i);e&&s.append("Content-Type",e)}let a=Vr(e)?e.signal:null;if("signal"in r&&(a=r.signal),null!=a&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(a))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[Qr]={method:n,redirect:r.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:a},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[Qr].method}get url(){return Hr(this[Qr].parsedURL)}get headers(){return this[Qr].headers}get redirect(){return this[Qr].redirect}get signal(){return this[Qr].signal}clone(){return new Jr(this)}}function Xr(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}jr.mixIn(Jr.prototype),Object.defineProperty(Jr.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Jr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),Xr.prototype=Object.create(Error.prototype),Xr.prototype.constructor=Xr,Xr.prototype.name="AbortError";const Zr=e.PassThrough,Kr=r.resolve;function Yr(r,s){if(!Yr.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return jr.Promise=Yr.Promise,new Yr.Promise((function(a,o){const u=new Jr(r,s),c=function(t){const r=t[Qr].parsedURL,n=new Lr(t[Qr].headers);if(n.has("Accept")||n.set("Accept","*/*"),!r.protocol||!r.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(r.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(t.signal&&t.body instanceof e.Readable&&!Wr)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let i=null;if(null==t.body&&/^(POST|PUT)$/i.test(t.method)&&(i="0"),null!=t.body){const e=kr(t);"number"==typeof e&&(i=String(e))}i&&n.set("Content-Length",i),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),t.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate");let s=t.agent;return"function"==typeof s&&(s=s(r)),n.has("Connection")||s||n.set("Connection","close"),Object.assign({},r,{method:t.method,headers:Fr(n),agent:s})}(u),l=("https:"===c.protocol?n:t).request,d=u.signal;let h=null;const f=function(){let t=new Xr("The user aborted a request.");o(t),u.body&&u.body instanceof e.Readable&&u.body.destroy(t),h&&h.body&&h.body.emit("error",t)};if(d&&d.aborted)return void f();const p=function(){f(),_()},b=l(c);let g;function _(){b.abort(),d&&d.removeEventListener("abort",p),clearTimeout(g)}d&&d.addEventListener("abort",p),u.timeout&&b.once("socket",(function(e){g=setTimeout((function(){o(new yr(`network timeout at: ${u.url}`,"request-timeout")),_()}),u.timeout)})),b.on("error",(function(e){o(new yr(`request to ${u.url} failed, reason: ${e.message}`,"system",e)),_()})),b.on("response",(function(e){clearTimeout(g);const t=function(e){const t=new Lr;for(const r of Object.keys(e))if(!Er.test(r))if(Array.isArray(e[r]))for(const n of e[r])Ir.test(n)||(void 0===t[Pr][r]?t[Pr][r]=[n]:t[Pr][r].push(n));else Ir.test(e[r])||(t[Pr][r]=[e[r]]);return t}(e.headers);if(Yr.isRedirect(e.statusCode)){const r=t.get("Location"),n=null===r?null:Kr(u.url,r);switch(u.redirect){case"error":return o(new yr(`uri requested responds with a redirect, redirect mode is set to error: ${u.url}`,"no-redirect")),void _();case"manual":if(null!==n)try{t.set("Location",n)}catch(e){o(e)}break;case"follow":if(null===n)break;if(u.counter>=u.follow)return o(new yr(`maximum redirect reached at: ${u.url}`,"max-redirect")),void _();const r={headers:new Lr(u.headers),follow:u.follow,counter:u.counter+1,agent:u.agent,compress:u.compress,method:u.method,body:u.body,signal:u.signal,timeout:u.timeout,size:u.size};return 303!==e.statusCode&&u.body&&null===kr(u)?(o(new yr("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void _()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==u.method)||(r.method="GET",r.body=void 0,r.headers.delete("content-length")),a(Yr(new Jr(n,r))),void _())}}e.once("end",(function(){d&&d.removeEventListener("abort",p)}));let r=e.pipe(new Zr);const n={url:u.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:u.size,timeout:u.timeout,counter:u.counter},s=t.get("Content-Encoding");if(!u.compress||"HEAD"===u.method||null===s||204===e.statusCode||304===e.statusCode)return h=new zr(r,n),void a(h);const c={flush:i.Z_SYNC_FLUSH,finishFlush:i.Z_SYNC_FLUSH};if("gzip"==s||"x-gzip"==s)return r=r.pipe(i.createGunzip(c)),h=new zr(r,n),void a(h);if("deflate"!=s&&"x-deflate"!=s){if("br"==s&&"function"==typeof i.createBrotliDecompress)return r=r.pipe(i.createBrotliDecompress()),h=new zr(r,n),void a(h);h=new zr(r,n),a(h)}else{e.pipe(new Zr).once("data",(function(e){r=8==(15&e[0])?r.pipe(i.createInflate()):r.pipe(i.createInflateRaw()),h=new zr(r,n),a(h)}))}})),function(e,t){const r=t.body;null===r?e.end():Or(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}(b,u)}))}Yr.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},Yr.Promise=global.Promise;var en=S(Object.freeze({__proto__:null,default:Yr,Headers:Lr,Request:Jr,Response:zr,FetchError:yr}));!function(e,t){const r=en,n=r.default||r,i=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),n.call(this,e,t)};i.ponyfill=!0,e.exports=t=i,t.fetch=i,t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response,t.default=i}(fr,fr.exports);var tn=fr.exports,rn=Object.freeze(u({__proto__:null,default:tn},[fr.exports]));const nn=(e,t,r)=>{var n,i;if($t(e),!_t(t))throw new Zt(t);if(!Wt(r)&&!_t(r))throw new Kt(r);const s=w(t),a=null!==(n=e.predicates[s])&&void 0!==n?n:{},o=null!==(i=a.namedNodes)&&void 0!==i?i:[];let u;u=pt(r)?r.value:"string"==typeof r?r:Jt(r)?r.url:Vt(r);const c=We(o.concat(w(u))),l=We(Object.assign(Object.assign({},a),{namedNodes:c})),d=We(Object.assign(Object.assign({},e.predicates),{[s]:l}));return We(Object.assign(Object.assign({},e),{predicates:d}))},sn=nn,an=(e,t,r)=>($t(e),_n(e,t,function(e){return e?"true":"false"}(r),Ye)),on=(e,t,r)=>($t(e),_n(e,t,function(e){return e.toISOString()}(r),et)),un=(e,t,r)=>($t(e),_n(e,t,function(e){const t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),[i,s]=ct(e.toISOString());return`${t}-${String(r).padStart(2,"0")}-${String(n).padStart(2,"0")}${s}`}(r),tt)),cn=(e,t,r)=>($t(e),_n(e,t,function(e){let t,r;if(e.millisecond&&(t=e.millisecond<10?"00"+e.millisecond:e.millisecond<100?"0"+e.millisecond:e.millisecond),"number"==typeof e.timezoneHourOffset){const t=Math.abs(e.timezoneHourOffset)<10?"0"+Math.abs(e.timezoneHourOffset):Math.abs(e.timezoneHourOffset);r=e.timezoneHourOffset>=0?"+"+t:"-"+t,e.timezoneMinuteOffset?r=r+":"+(e.timezoneMinuteOffset<10?"0"+e.timezoneMinuteOffset:e.timezoneMinuteOffset):r+=":00"}return(e.hour<10?"0"+e.hour:e.hour)+":"+(e.minute<10?"0"+e.minute:e.minute)+":"+(e.second<10?"0"+e.second:e.second)+(e.millisecond?"."+t:"")+(r||"")}(r),rt)),ln=(e,t,r)=>($t(e),_n(e,t,function(e){return e.toString()}(r),nt)),dn=(e,t,r)=>($t(e),_n(e,t,function(e){return e.toString()}(r),it));function hn(e,t,r,n){var i,s,a;if($t(e),!_t(t))throw new Zt(t);const o=w(t),u=ft(n),c=null!==(i=e.predicates[o])&&void 0!==i?i:{},l=null!==(s=c.langStrings)&&void 0!==s?s:{},d=null!==(a=l[u])&&void 0!==a?a:[],h=We(d.concat(r)),f=We(Object.assign(Object.assign({},l),{[u]:h})),p=We(Object.assign(Object.assign({},c),{langStrings:f})),b=We(Object.assign(Object.assign({},e.predicates),{[o]:p}));return We(Object.assign(Object.assign({},e),{predicates:b}))}const fn=(e,t,r)=>($t(e),_n(e,t,r,st));function pn(e,t,r){return nn(e,t,r.value)}function bn(e,t,r){if($t(e),!_t(t))throw new Zt(t);return r.datatype.value===at?hn(e,t,r.value,r.language):_n(e,t,r.value,r.datatype.value)}function gn(e,t,r){var n,i;if("NamedNode"===r.termType)return pn(e,t,r);if("Literal"===r.termType)return bn(e,t,r);if("BlankNode"===r.termType){if($t(e),!_t(t))throw new Zt(t);const s=w(t),a=null!==(n=e.predicates[s])&&void 0!==n?n:{},o=null!==(i=a.blankNodes)&&void 0!==i?i:[],u=We(o.concat(Ke(r))),c=We(Object.assign(Object.assign({},a),{blankNodes:u})),l=We(Object.assign(Object.assign({},e.predicates),{[s]:c}));return We(Object.assign(Object.assign({},e),{predicates:l}))}throw new Error(`Term type [${r.termType}] is not supported by @inrupt/solid-client.`)}function _n(e,t,r,n){var i,s,a;if($t(e),!_t(t))throw new Zt(t);const o=w(t),u=null!==(i=e.predicates[o])&&void 0!==i?i:{},c=null!==(s=u.literals)&&void 0!==s?s:{},l=null!==(a=c[n])&&void 0!==a?a:[],d=We(l.concat(r)),h=We(Object.assign(Object.assign({},c),{[n]:d})),f=We(Object.assign(Object.assign({},u),{literals:h})),p=We(Object.assign(Object.assign({},e.predicates),{[o]:f}));return We(Object.assign(Object.assign({},e),{predicates:p}))}function yn(e,t){if($t(e),!_t(t))throw new Zt(t);const r=w(t),n=Object.assign({},e.predicates);return delete n[r],We(Object.assign(Object.assign({},e),{predicates:We(n)}))}const mn=(e,t,r)=>{var n,i,s;if($t(e),!_t(t))throw new Zt(t);const a=w(t);if(!Wt(r)&&!_t(r))throw new Kt(r);const o=pt(r)?r.value:"string"==typeof r?r:Vt(r),u=We(null!==(s=null===(i=null===(n=e.predicates[a])||void 0===n?void 0:n.namedNodes)||void 0===i?void 0:i.filter((e=>e.toLowerCase()!==o.toLowerCase())))&&void 0!==s?s:[]),c=We(Object.assign(Object.assign({},e.predicates[a]),{namedNodes:u})),l=We(Object.assign(Object.assign({},e.predicates),{[a]:c}));return We(Object.assign(Object.assign({},e),{predicates:l}))},vn=mn,wn=(e,t,r)=>($t(e),Nn(e,t,Ye,(e=>ot(e)===r))),jn=(e,t,r)=>($t(e),Nn(e,t,et,(e=>{var t;return(null===(t=ut(e))||void 0===t?void 0:t.getTime())===r.getTime()}))),xn=(e,t,r)=>($t(e),Nn(e,t,tt,(function(e){const t=function(e){if(!/-?\d{4,}-\d\d-\d\d(Z|(\+|-)\d\d:\d\d)?/.test(e))return null;const t=e,[r,n]="-"===t.charAt(0)?[-1,t.substring(1)]:[1,t],[i,s,a]=n.split("-"),o=a.length>2?a.substring(0,2):a,u=Number.parseInt(i,10)*r,c=Number.parseInt(s,10)-1,l=Number.parseInt(o,10),d=new Date(Date.UTC(u,c,l,12));return u>=0&&u<100&&d.setUTCFullYear(d.getUTCFullYear()-1900),d}(e);return!!t&&(t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate())}))),Sn=(e,t,r)=>($t(e),Nn(e,t,rt,(function(e){const t=function(e){if(!/\d\d:\d\d:\d\d(\.\d+)?(Z|(\+|-)\d\d:\d\d)?/.test(e))return null;const[t,r]=ct(e),[n,i,s]=t.split(":");let a=Number.parseInt(n,10),o=Number.parseInt(i,10);const[u,c]=s.split("."),l=Number.parseInt(u,10),d=c?Number.parseInt(c,10):void 0;o>=60&&(a+=1,o-=60);const h={hour:a,minute:o,second:l};if("number"==typeof d&&(h.millisecond=d),"string"==typeof r){const[e,t]=lt(r);if("number"!=typeof e||e>24||"number"!=typeof t||t>59)return null;h.timezoneHourOffset=e,h.timezoneMinuteOffset=t}return h}(e);return!!t&&(t.hour===r.hour&&t.minute===r.minute&&t.second===r.second&&t.millisecond===r.millisecond&&t.timezoneHourOffset===r.timezoneHourOffset&&t.timezoneMinuteOffset===r.timezoneMinuteOffset)}))),On=(e,t,r)=>($t(e),Nn(e,t,nt,(e=>dt(e)===r))),Rn=(e,t,r)=>($t(e),Nn(e,t,it,(e=>ht(e)===r)));function Tn(e,t,r,n){var i,s;if($t(e),!_t(t))throw new Zt(t);const a=w(t),o=null!==(s=null===(i=e.predicates[a])||void 0===i?void 0:i.langStrings)&&void 0!==s?s:{},u=Object.keys(o).find((e=>ft(e)===ft(n)&&Array.isArray(o[e])&&o[e].length>0));if("string"!=typeof u)return e;const c=o[u],l=We(c.filter((e=>e!==r))),d=We(Object.assign(Object.assign({},o),{[u]:l})),h=We(Object.assign(Object.assign({},e.predicates[a]),{langStrings:d})),f=We(Object.assign(Object.assign({},e.predicates),{[a]:h}));return We(Object.assign(Object.assign({},e),{predicates:f}))}const kn=(e,t,r)=>($t(e),Nn(e,t,st,(e=>e===r)));function En(e,t,r){return mn(e,t,r.value)}function In(e,t,r){var n,i,s;if($t(e),!_t(t))throw new Zt(t);const a=r.datatype.value;if(a===at)return Tn(e,t,r.value,r.language);const o=w(t),u=null!==(n=e.predicates[o])&&void 0!==n?n:{},c=null!==(i=u.literals)&&void 0!==i?i:{},l=null!==(s=c[a])&&void 0!==s?s:[],d=We(l.filter((e=>e!==r.value))),h=We(Object.assign(Object.assign({},c),{[a]:d})),f=We(Object.assign(Object.assign({},u),{literals:h})),p=We(Object.assign(Object.assign({},e.predicates),{[o]:f}));return We(Object.assign(Object.assign({},e),{predicates:p}))}function Nn(e,t,r,n){var i,s,a;if(!_t(t))throw new Zt(t);const o=w(t),u=null!==(i=e.predicates[o])&&void 0!==i?i:{},c=null!==(s=u.literals)&&void 0!==s?s:{},l=null!==(a=c[r])&&void 0!==a?a:[],d=We(l.filter((e=>!n(e)))),h=We(Object.assign(Object.assign({},c),{[r]:d})),f=We(Object.assign(Object.assign({},u),{literals:h})),p=We(Object.assign(Object.assign({},e.predicates),{[o]:f}));return We(Object.assign(Object.assign({},e),{predicates:p}))}const An=(e,t,r)=>{if($t(e),!_t(t))throw new Zt(t);if(!Wt(r)&&!_t(r))throw new Kt(r);return nn(yn(e,t),t,r)},Cn=An,Pn=(e,t,r)=>($t(e),an(yn(e,t),t,r)),Ln=(e,t,r)=>($t(e),on(yn(e,t),t,r)),$n=(e,t,r)=>($t(e),un(yn(e,t),t,r)),Dn=(e,t,r)=>($t(e),cn(yn(e,t),t,r)),Mn=(e,t,r)=>($t(e),ln(yn(e,t),t,r)),Bn=(e,t,r)=>($t(e),dn(yn(e,t),t,r));function Fn(e,t,r,n){return $t(e),hn(yn(e,t),t,r,n)}const Un=(e,t,r)=>($t(e),fn(yn(e,t),t,r));function qn(e,t,r){return $t(e),pn(yn(e,t),t,r)}function zn(e,t,r){return $t(e),bn(yn(e,t),t,r)}function Qn(e,t,r){if($t(e),!_t(t))throw new Zt(t);return gn(yn(e,t),t,r)}function Gn(e=Ht()){let t=Wt(e)?e:Ht(e);function r(e){return(r,n)=>(t=e(t,r,n),s)}function n(e){return(r,n)=>(t=e(t,r,n),s)}function i(e){return(r,n)=>(t=e(t,r,n),s)}const s={build:()=>t,addUrl:r(nn),addIri:r(sn),addBoolean:r(an),addDatetime:r(on),addDate:r(un),addTime:r(cn),addDecimal:r(ln),addInteger:r(dn),addStringNoLocale:r(fn),addStringEnglish:(e,r)=>(t=hn(t,e,r,"en"),s),addStringWithLocale:(e,r,n)=>(t=hn(t,e,r,n),s),addNamedNode:r(pn),addLiteral:r(bn),addTerm:r(gn),setUrl:n(An),setIri:n(Cn),setBoolean:n(Pn),setDatetime:n(Ln),setDate:n($n),setTime:n(Dn),setDecimal:n(Mn),setInteger:n(Bn),setStringNoLocale:n(Un),setStringEnglish:(e,r)=>(t=Fn(t,e,r,"en"),s),setStringWithLocale:(e,r,n)=>(t=Fn(t,e,r,n),s),setNamedNode:n(qn),setLiteral:n(zn),setTerm:n(Qn),removeAll:e=>(t=yn(t,e),s),removeUrl:i(mn),removeIri:i(vn),removeBoolean:i(wn),removeDatetime:i(jn),removeDate:i(xn),removeTime:i(Sn),removeDecimal:i(On),removeInteger:i(Rn),removeStringNoLocale:i(kn),removeStringEnglish:(e,r)=>Gn(Tn(t,e,r,"en")),removeStringWithLocale:(e,r,n)=>Gn(Tn(t,e,r,n)),removeNamedNode:i(En),removeLiteral:i(In)};return s}async function Hn(e,t=se){if(!hi(e))return{resourceAcl:null,fallbackAcl:null};try{const r=await Wn(e,t);return null===r?{resourceAcl:null,fallbackAcl:await Vn(e,t)}:{resourceAcl:r,fallbackAcl:null}}catch(e){if(e instanceof si)return{resourceAcl:null,fallbackAcl:null};throw e}}async function Wn(e,t=se){if(!hi(e))return null;try{const r=await nr(e.internal_resourceInfo.aclUrl,t);if(function(e){const t=(r=e,r.internal_resourceInfo.linkedResources).type;var r;return Array.isArray(t)&&t.includes(ie)}(r))throw new si(e,r);return We(Object.assign(Object.assign({},r),{internal_accessTo:ce(e)}))}catch(e){if(e instanceof si)throw e;return null}}async function Vn(e,t=se){const r=new URL(ce(e)),n=r.pathname;if("/"===n)return null;const i=function(e){const t="/"===e.substring(e.length-1)?e.substring(0,e.length-1):e;return e.substring(0,t.lastIndexOf("/"))+"/"}(n),s=new URL(i,r.origin).href,a=await ae(s,t);if(!hi(a))return null;const o=await Wn(a,t);return null===o?Vn(a,t):o}function Jn(e){return zt(e).filter(Xn)}function Xn(e){return Ut(e,Y).includes(Q)}function Zn(e,t){return e.filter((e=>function(e,t){return Ut(e,J).includes(t)||Ut(e,X).includes(t)}(e,t)))}function Kn(e){return!Et(e.predicates,vt.namedNode(e.url),vt.defaultGraph()).some((e=>!function(e){const t=e.predicate,r=e.object;if(t.equals(vt.namedNode(Y))&&r.equals(vt.namedNode(Q)))return!0;if(t.equals(vt.namedNode(G))||t.equals(vt.namedNode(J))||t.equals(vt.namedNode(X)))return!0;if(t.equals(vt.namedNode(Z))&&Object.values(Yn).some((e=>r.equals(vt.namedNode(e)))))return!0;if(t.equals(vt.namedNode(H))||t.equals(vt.namedNode(W))||t.equals(vt.namedNode(V)))return!0;if(t.equals(vt.namedNode(K)))return!0;return!1}(e)))&&(null===Bt(e,G)&&null===Bt(e,J)&&null===Bt(e,X)||(null===Bt(e,Z)||null===Bt(e,H)&&null===Bt(e,W)&&null===Bt(e,V)))}const Yn={read:"http://www.w3.org/ns/auth/acl#Read",append:"http://www.w3.org/ns/auth/acl#Append",write:"http://www.w3.org/ns/auth/acl#Write",control:"http://www.w3.org/ns/auth/acl#Control"};function ei(e){let t=Ht();return t=Cn(t,Y,Q),e.read&&(t=sn(t,Z,Yn.read)),e.append&&!e.write&&(t=sn(t,Z,Yn.append)),e.write&&(t=sn(t,Z,Yn.write)),e.control&&(t=sn(t,Z,Yn.control)),t}function ti(e,t){return Object.assign(q(e),{internal_acl:t})}const ri=[H,V,W,K];function ni(e,t,r,n,i){if(!Ut(e,r).includes(t)){return[e,ei({read:!1,append:!1,write:!1,control:!1})]}const s=vn(e,r,t);let a=function(e){let t=Ht();function r(e,t,r){return Ut(e,r).reduce(((e,t)=>sn(e,r,t)),t)}return t=Cn(t,Y,Q),t=r(e,t,G),t=r(e,t,J),t=r(e,t,X),t=r(e,t,H),t=r(e,t,W),t=r(e,t,V),t=r(e,t,K),t=r(e,t,Z),t}(e);return a=vn(a,"resource"===i?G:J,n),"default"===i&&(a=vn(a,X,n)),a=Cn(a,r,t),ri.filter((e=>e!==r)).forEach((e=>{a=yn(a,e)})),[s,a]}function ii(e,t,r,n,i){let s=e;zt(e).forEach((t=>{const[a,o]=ni(t,i,r,e.internal_accessTo,n);s=Qt(s,a),s=Qt(s,o)}));let a=ei(t);a=Cn(a,"resource"===n?G:J,e.internal_accessTo),a=Cn(a,r,i);return function(e){return Jn(e).filter(Kn).reduce(Gt,e)}(Qt(s,a))}class si extends Error{constructor(e,t){super(`[${le(e)}] is governed by Access Control Policies in [${le(t)}] rather than by Web Access Control.`)}}function ai(e){return null!==e.internal_acl.resourceAcl&&ce(e)===e.internal_acl.resourceAcl.internal_accessTo&&e.internal_resourceInfo.aclUrl===ce(e.internal_acl.resourceAcl)}async function oi(e,t=se){const r=await nr(e,t);return ti(r,await Hn(r,t))}async function ui(e,t=se){const r=await pe(e,t);return ti(r,await Hn(r,t))}function ci(e){return ai(e)?e.internal_acl.resourceAcl:null}function li(e){const t=(r=e,We(Object.assign(Object.assign({},rr()),{internal_accessTo:ce(r),internal_resourceInfo:{sourceIri:r.internal_resourceInfo.aclUrl,isRawData:!1,linkedResources:{}}})));var r;return Zn(Jn(e.internal_acl.fallbackAcl),e.internal_acl.fallbackAcl.internal_accessTo).map((t=>(t=yn(t,J),t=yn(t,X),t=Cn(t,G,ce(e)),t=Cn(t,J,ce(e))))).reduce(Qt,t)}async function di(e,t,r=se){if(!hi(e))throw new Error(`Could not determine the location of the ACL for the Resource at [${ce(e)}]; possibly the current user does not have Control access to that Resource. Try calling \`hasAccessibleAcl()\` before calling \`saveAclFor()\`.`);const n=await ir(e.internal_resourceInfo.aclUrl,t,r);return Object.assign(Object.assign({},n),{internal_accessTo:ce(e)})}function hi(e){return"string"==typeof e.internal_resourceInfo.aclUrl}function fi(e,t,r){return ii(e,r,H,"resource",t)}var pi,bi;!function(e){e.FILE="file",e.DATASET="dataset",e.CONTAINER="container"}(pi||(pi={})),function(e){e.NTriples="application/n-triples",e.Turtle="text/turtle",e.NQuads="application/n-quads",e.Trig="application/trig",e.SPARQLJSON="application/sparql-results+json",e.JSONLD="application/ld+json",e.DLOG="application/x.datalog",e.Text="text/plain"}(bi||(bi={}));var gi=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d(this,e),p(this,"verbose",!1),this.fetch=t,this.verbose=r}var t,r,n,i;return f(e,[{key:"makePublic",value:(i=l(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={read:!0,append:!0,write:!1,control:!1},e.abrupt("return",this.setResourceAccess(t,r,pi.CONTAINER));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"makeFilePublic",value:(n=l(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={read:!0,append:!0,write:!1,control:!1},e.abrupt("return",this.setResourceAccess(t,r,pi.FILE));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setResourceAccess",value:(r=l(regeneratorRuntime.mark((function e(t,r,n,i){var s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!=pi.DATASET&&n!=pi.CONTAINER){e.next=4;break}return e.next=3,oi(t,{fetch:this.fetch});case 3:s=e.sent;case 4:if(n!=pi.FILE){e.next=8;break}return e.next=7,ui(t,{fetch:this.fetch});case 7:s=e.sent;case 8:return e.next=10,this.getResourceAcl(s);case 10:return a=e.sent,o=i&&null!=i?fi(a,i,r):ii(a,r,V,"resource",ne),e.next=14,di(s,o,{fetch:this.fetch});case 14:return u=e.sent,this.verbose&&this.logAccessInfo(r,t),e.abrupt("return",u);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"getResourceAcl",value:(t=l(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ai(t)){e.next=8;break}if(hi(t)){e.next=3;break}throw new Error("The current user does not have permission to change access rights to this Resource.");case 3:if(null!==t.internal_acl.fallbackAcl){e.next=5;break}throw new Error("The current user does not have permission to see who currently has access to this Resource.");case 5:r=li(t),e.next=9;break;case 8:r=ci(t);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"logAccessInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";null===e?console.log("Could not load access details for this Resource."):(r?console.log("Public Access:: ",JSON.stringify(e)):console.log("".concat(r,"'s Access:: "),JSON.stringify(e)),console.log("...",r,e.read?"CAN":"CANNOT","read the Resource",t),console.log("...",r,e.append?"CAN":"CANNOT","add data to the Resource",t),console.log("...",r,e.write?"CAN":"CANNOT","change data in the Resource",t),"controlRead"in e?(console.log("...",r,e.controlRead?"CAN":"CANNOT","see access to the Resource",t),console.log("...",r,e.controlWrite?"CAN":"CANNOT","change access to the Resource",t)):console.log("...",r,e.control?"CAN":"CANNOT","change access to the Resource",t))}}]),e}(),_i={},yi={},mi={};Object.defineProperty(mi,"__esModule",{value:!0}),mi.DELIMITER_PATH="/",mi.DELIMITER_URL_PARTS="?",mi.DELIMITER_SEARCH_PARAMS="&",mi.DELIMITER_SEARCH_VALUES="=",Object.defineProperty(yi,"__esModule",{value:!0});const vi=mi,wi=/^\/|\/$/g,ji=(e="")=>e.replace(wi,""),xi=(e="",t)=>0===t?e:e.replace(wi,"");yi.UrlJoin=class{constructor(e,t){this.baseUrl=e,this.paths=t,this.params=null}toString(){const e=null!==this.baseUrl&&void 0!==this.baseUrl;let t=[this.baseUrl,...this.paths].filter(Boolean).map(e?ji:xi).join(vi.DELIMITER_PATH);if(this.hasParams()){const e=Object.keys(this.params).map((e=>encodeURIComponent(e)+vi.DELIMITER_SEARCH_VALUES+encodeURIComponent(this.params[e]))).join(vi.DELIMITER_SEARCH_PARAMS);t+=vi.DELIMITER_URL_PARTS+e}return t}queryParams(e){return this.params=e,this}hasParams(){return!!this.params&&Object.keys(this.params).length>0}};var Si={};Object.defineProperty(Si,"__esModule",{value:!0});const Oi=yi;Si.urlJoin=function(e,...t){return new Oi.UrlJoin(e,t).toString()},Si.urlJoinP=function(e,t,r={}){return new Oi.UrlJoin(e,t).queryParams(r).toString()},function(e){function t(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),t(yi),t(Si)}(_i);var Ri=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d(this,e),p(this,"verbose",!1),this.fetch=t,this.verbose=r,this.accessService=new gi(t)}var t,r,n,i,s;return f(e,[{key:"writeFileToPod",value:(s=l(regeneratorRuntime.mark((function e(t,r){var n,i,s,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>2&&void 0!==a[2]&&a[2],i=a.length>3&&void 0!==a[3]?a[3]:bi.Text,e.next=4,ge(r,t,{contentType:i,fetch:this.fetch});case 4:if(s=e.sent,this.verbose&&console.log("File saved at ".concat(ce(s))),!n){e.next=9;break}return e.next=9,this.accessService.makeFilePublic(r);case 9:return e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"getFile",value:(i=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verbose&&console.log("Getting file ".concat(t,"...")),e.abrupt("return",pe(t,{fetch:this.fetch}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"deleteFile",value:(n=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verbose&&console.log("Deleting file ".concat(t,"...")),e.abrupt("return",be(t,{fetch:this.fetch}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"deleteContainer",value:(r=l(regeneratorRuntime.mark((function e(t){var r,n,i,s,a,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.length>1&&void 0!==o[1]&&!o[1]){e.next=31;break}return console.log("Deleting container ".concat(t," including its subfolders...")),e.next=5,nr(t,{fetch:this.fetch});case 5:return r=e.sent,e.next=8,lr(r);case 8:n=e.sent,i=g(n),e.prev=10,i.s();case 12:if((s=i.n()).done){e.next=23;break}if(!ue(a=s.value)){e.next=19;break}return e.next=17,this.deleteContainer(a,!0);case 17:e.next=21;break;case 19:return e.next=21,this.deleteFile(a);case 21:e.next=12;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(10),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return console.log("Deleting container ".concat(t,"...")),e.abrupt("return",cr(t,{fetch:this.fetch}));case 33:case"end":return e.stop()}}),e,this,[[10,25,28,31]])}))),function(e){return r.apply(this,arguments)})},{key:"createContainer",value:(t=l(regeneratorRuntime.mark((function e(t){var r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]&&i[1],this.verbose&&console.log("Creating container ".concat(t,"...")),e.next=4,sr(t,{fetch:this.fetch});case 4:if(n=e.sent,!r){e.next=8;break}return e.next=8,this.accessService.makePublic(t);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Ti={exports:{}};function ki(e){return new Promise((function(t,r){var n=5242880,i=new Ti.exports.ArrayBuffer,s=new FileReader,a=0;function o(t){var r=Math.min(e.size,t+n);s.readAsArrayBuffer(e.slice(t,r))}s.onerror=function(){r("MD5 computation failed - error reading the file")},s.onload=function(r){i.append(r.target.result),(a+=n)<e.size?o(a):t(i.end())},o(0)}))}Ti.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],s=e[3];n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|s>>>20)+r|0)&r|~s&n)+t[2]+606105819|0)<<17|i>>>15)+s|0)&s|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|s>>>20)+r|0)&r|~s&n)+t[6]-1473231341|0)<<17|i>>>15)+s|0)&s|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|s>>>20)+r|0)&r|~s&n)+t[10]-42063|0)<<17|i>>>15)+s|0)&s|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&i|~n&s)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|s>>>20)+r|0)&r|~s&n)+t[14]-1502002290|0)<<17|i>>>15)+s|0)&s|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|s>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+s|0)&r|s&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|s>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+s|0)&r|s&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|s>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+s|0)&r|s&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n&s|i&~s)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|s>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+s|0)&r|s&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|s>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+s|0)^s^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|s>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+s|0)^s^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|s>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+s|0)^s^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((s=((s+=((r=((r+=(n^i^s)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|s>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+s|0)^s^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+t[14]-1416354905|0)<<15|i>>>17)+s|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+t[10]-1051523|0)<<15|i>>>17)+s|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+t[6]-1560198380|0)<<15|i>>>17)+s|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((s=((s+=(n^((r=((r+=(i^(n|~s))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|s>>>22)+r|0)^((i=((i+=(r^(s|~n))+t[2]+718787259|0)<<15|i>>>17)+s|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=s+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function s(e){var t,i,s,a,o,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)r(l,n(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(r(l,s),t=0;t<16;t+=1)s[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(a[2],16),u=parseInt(a[1],16)||0,s[14]=o,s[15]=u,r(l,s),l}function a(e){var t,n,s,a,o,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)r(l,i(e.subarray(t-64,t)));for(n=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)s[t>>2]|=e[t]<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(r(l,s),t=0;t<16;t+=1)s[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(a[2],16),u=parseInt(a[1],16)||0,s[14]=o,s[15]=u,r(l,s),l}function o(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function u(e){var t;for(t=0;t<e.length;t+=1)e[t]=o(e[t]);return e.join("")}function c(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function l(e,t){var r,n=e.length,i=new ArrayBuffer(n),s=new Uint8Array(i);for(r=0;r<n;r+=1)s[r]=e.charCodeAt(r);return t?s:i}function d(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function h(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function f(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function p(){this.reset()}return u(s("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,s,a,o,u=this.byteLength,c=t(r,u),l=u;return n!==e&&(l=t(n,u)),c>l?new ArrayBuffer(0):(i=l-c,s=new ArrayBuffer(i),a=new Uint8Array(s),o=new Uint8Array(this,c,i),a.set(o),s)}}(),p.prototype.append=function(e){return this.appendBinary(c(e)),this},p.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},p.prototype.end=function(e){var t,r,n=this._buff,i=n.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)s[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(s,i),r=u(this._hash),e&&(r=f(r)),this.reset(),r},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(e,t){var n,i,s,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(r(this._hash,e),a=0;a<16;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),s=parseInt(n[1],16)||0,e[14]=i,e[15]=s,r(this._hash,e)},p.hash=function(e,t){return p.hashBinary(c(e),t)},p.hashBinary=function(e,t){var r=u(s(e));return t?f(r):r},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(e){var t,n=h(this._buff.buffer,e,!0),s=n.length;for(this._length+=e.byteLength,t=64;t<=s;t+=64)r(this._hash,i(n.subarray(t-64,t)));return this._buff=t-64<s?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)s[t>>2]|=n[t]<<(t%4<<3);return this._finish(s,i),r=u(this._hash),e&&(r=f(r)),this.reset(),r},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var e=p.prototype.getState.call(this);return e.buff=d(e.buff),e},p.ArrayBuffer.prototype.setState=function(e){return e.buff=l(e.buff,!0),p.prototype.setState.call(this,e)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(e,t){var r=u(a(new Uint8Array(e)));return t?f(r):r},p}();function Ei(e){return"http://www.w3.org/ns/dcat#"+e}var Ii={PREFIX:"dcat",NAMESPACE:"http://www.w3.org/ns/dcat#",PREFIX_AND_NAMESPACE:{dcat:"http://www.w3.org/ns/dcat#"},NS:Ei,Catalog:Ei("Catalog"),Dataset:Ei("Dataset"),Resource:Ei("Resource"),CatalogRecord:Ei("CatalogRecord"),DataService:Ei("DataService"),Distribution:Ei("Distribution"),Relationship:Ei("Relationship"),Role:Ei("Role"),hadRole:Ei("hadRole"),accessService:Ei("accessService"),accessURL:Ei("accessURL"),endpointURL:Ei("endpointURL"),bbox:Ei("bbox"),byteSize:Ei("byteSize"),catalog:Ei("catalog"),centroid:Ei("centroid"),compressFormat:Ei("compressFormat"),contactPoint:Ei("contactPoint"),dataset:Ei("dataset"),distribution:Ei("distribution"),downloadURL:Ei("downloadURL"),endDate:Ei("endDate"),endpointDescription:Ei("endpointDescription"),keyword:Ei("keyword"),landingPage:Ei("landingPage"),mediaType:Ei("mediaType"),packageFormat:Ei("packageFormat"),qualifiedRelation:Ei("qualifiedRelation"),record:Ei("record"),servesDataset:Ei("servesDataset"),service:Ei("service"),spatialResolutionInMeters:Ei("spatialResolutionInMeters"),startDate:Ei("startDate"),temporalResolution:Ei("temporalResolution"),theme:Ei("theme"),themeTaxonomy:Ei("themeTaxonomy")},Ni="http://www.w3.org/1999/02/22-rdf-syntax-ns#";function Ai(e){return Ni+e}var Ci={PREFIX:"rdf",NAMESPACE:Ni,PREFIX_AND_NAMESPACE:{rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"},NS:Ai,Property:Ai("Property"),HTML:Ai("HTML"),langString:Ai("langString"),PlainLiteral:Ai("PlainLiteral"),Statement:Ai("Statement"),Bag:Ai("Bag"),Seq:Ai("Seq"),Alt:Ai("Alt"),List:Ai("List"),XMLLiteral:Ai("XMLLiteral"),JSON:Ai("JSON"),CompoundLiteral:Ai("CompoundLiteral"),type:Ai("type"),subject:Ai("subject"),predicate:Ai("predicate"),object:Ai("object"),value:Ai("value"),nil:Ai("nil"),first:Ai("first"),rest:Ai("rest"),language:Ai("language"),direction:Ai("direction")};function Pi(e){return"http://schema.org/"+e}var Li={PREFIX:"schema-inrupt",NAMESPACE:"http://schema.org/",PREFIX_AND_NAMESPACE:{"schema-inrupt":"http://schema.org/"},NS:Pi,Person:Pi("Person"),URL:Pi("URL"),MedicalTherapy:Pi("MedicalTherapy"),EducationalOccupationalCredential:Pi("EducationalOccupationalCredential"),PostalAddress:Pi("PostalAddress"),Product:Pi("Product"),alternateName:Pi("alternateName"),givenName:Pi("givenName"),familyName:Pi("familyName"),additionalName:Pi("additionalName"),license:Pi("license"),name:Pi("name"),text:Pi("text"),identifier:Pi("identifier"),description:Pi("description"),image:Pi("image"),url:Pi("url"),startTime:Pi("startTime"),endTime:Pi("endTime"),startDate:Pi("startDate"),endDate:Pi("endDate"),email:Pi("email"),primaryPrevention:Pi("primaryPrevention"),qualifications:Pi("qualifications"),attendee:Pi("attendee"),address:Pi("address"),streetAddress:Pi("streetAddress"),addressLocality:Pi("addressLocality"),addressRegion:Pi("addressRegion"),postalCode:Pi("postalCode"),addressCountry:Pi("addressCountry"),accessCode:Pi("accessCode"),accountId:Pi("accountId"),serialNumber:Pi("serialNumber"),productID:Pi("productID")},$i="https://standards.iso.org/iso/21598/-1/ed-1/en/Container#";function Di(e){return $i+e}var Mi,Bi={PREFIX:"container",NAMESPACE:$i,PREFIX_AND_NAMESPACE:{container:"https://standards.iso.org/iso/21598/-1/ed-1/en/Container#"},NS:Di,ContainerDescription:Di("ContainerDescription"),Document:Di("Document"),containsDocument:Di("containsDocument"),creationDate:Di("creationDate"),filename:Di("filename"),format:Di("format"),modificationDate:Di("modificationDate")},Fi=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d(this,e),p(this,"verbose",!1),this.fetch=t,this.verbose=r,this.accessService=new gi(t),this.dataService=new Ri(t)}var t,r,n,i,s,a,o,u;return f(e,[{key:"initICDD",value:(u=l(regeneratorRuntime.mark((function e(t,r){var n,i,s,a,o=this,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]&&u[2],i=_i.urlJoin(t,encodeURIComponent(r),"/"),this.verbose&&console.time("Created root container for ICDD..."),e.prev=3,e.next=6,this.dataService.createContainer(i,n);case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(3),this.verbose&&console.log("Could not create container ".concat(i)),e.t0;case 12:return this.verbose&&console.timeEnd("Created root container for ICDD..."),this.verbose&&console.time("Created ICDD subfolders..."),s=["ontology_resources","payload_triples","payload_documents"].map((function(e){return _i.urlJoin(t,r,e,"/")})),a=[],s.forEach((function(e){a.push(o.dataService.createContainer(e,n))})),this.verbose&&console.timeEnd("Created ICDD subfolders..."),e.prev=18,e.next=21,Promise.all(a);case 21:e.next=27;break;case 23:throw e.prev=23,e.t1=e.catch(18),console.log("Could not create sub-containers"),e.t1;case 27:return this.verbose&&console.time("Created index.rdf..."),e.prev=28,e.next=31,this.buildIndex(i,r,n);case 31:e.next=37;break;case 33:throw e.prev=33,e.t2=e.catch(28),console.log("Could not create index-file"),e.t2;case 37:return this.verbose&&console.timeEnd("Created index.rdf..."),e.abrupt("return","DONE");case 39:case"end":return e.stop()}}),e,this,[[3,8],[18,23],[28,33]])}))),function(e,t){return u.apply(this,arguments)})},{key:"deleteICDD",value:(o=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataService.deleteContainer(t);case 2:return e.abrupt("return","DONE");case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"addPayloadDocuments",value:(a=l(regeneratorRuntime.mark((function e(t,r){var n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]&&i[2],e.abrupt("return",this.addFiles(t,"payload_documents",r,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"addPayloadTriples",value:(s=l(regeneratorRuntime.mark((function e(t,r){var n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]&&i[2],e.abrupt("return",this.addFiles(t,"payload_triples",r,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"addOntologyResources",value:(i=l(regeneratorRuntime.mark((function e(t,r){var n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]&&i[2],e.abrupt("return",this.addFiles(t,"ontology_resources",r,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"addFiles",value:(n=l(regeneratorRuntime.mark((function e(t,r,n){var i,s,a,o,u,c=this,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l.length>3&&void 0!==l[3]&&l[3],s=_i.urlJoin(t,r,"/"),a=[],n.forEach((function(e){return a.push(ki(e))})),e.next=6,Promise.all(a);case 6:return o=e.sent,u=[],n.forEach((function(e,n){var a=e.name.split(".").pop()||"txt",l="".concat(o[n],".").concat(a);u.push(c.addFileToIndex(t,l,a,r));var d=_i.urlJoin(s,l);u.push(c.dataService.writeFileToPod(e,d,i))})),e.next=11,Promise.all(u);case 11:return e.abrupt("return","DONE");case 12:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"buildIndex",value:(r=l(regeneratorRuntime.mark((function e(t,r){var n,i,s,a,o,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(u.length>2&&void 0!==u[2])||u[2],i=rr(),s=new Date,a=Gn(Ht()).addUrl(Ci.type,Bi.ContainerDescription).addStringNoLocale(Li.name,r).addDatetime(Bi.creationDate,s).addDatetime(Bi.modificationDate,s).build(),i=Qt(i,a),e.next=7,ir(_i.urlJoin(t,"index"),i,{fetch:this.fetch});case 7:if(o=e.sent,!n){e.next=11;break}return e.next=11,this.accessService.makePublic(_i.urlJoin(t,"index"));case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"addFileToIndex",value:(t=l(regeneratorRuntime.mark((function e(t,r,n,i){var s,a,o,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Date,a="/".concat(i,"/").concat(r),e.next=4,nr(_i.urlJoin(t,"index"),{fetch:this.fetch});case 4:return o=e.sent,u=Gn(Ht()).addUrl(Ci.type,Bi.Document).addStringNoLocale(Bi.format,n).addStringNoLocale(Bi.filename,r).addStringNoLocale(Ii.downloadURL,a).addDatetime(Bi.creationDate,s).addDatetime(Bi.modificationDate,s).build(),o=Qt(o,u),null!=(c=zt(o).find((function(e){return-1!=Ft(e,Ci.type).indexOf(Bi.ContainerDescription)})))&&(c=Ln(c,Bi.modificationDate,s),c=nn(c,Bi.containsDocument,u),o=Qt(o,c)),e.next=11,ir(_i.urlJoin(t,"index"),o,{fetch:this.fetch});case 11:return l=e.sent,e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)}))),function(e,r,n,i){return t.apply(this,arguments)})}]),e}();(Mi||(Mi={})).ICDDService=Fi;const Ui="http://www.w3.org/1999/02/22-rdf-syntax-ns#",qi="http://www.w3.org/2001/XMLSchema#",zi="http://www.w3.org/2000/10/swap/";var Qi={xsd:{decimal:`${qi}decimal`,boolean:`${qi}boolean`,double:`${qi}double`,integer:`${qi}integer`,string:`${qi}string`},rdf:{type:`${Ui}type`,nil:`${Ui}nil`,first:`${Ui}first`,rest:`${Ui}rest`,langString:`${Ui}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${zi}reify#forSome`,forAll:`${zi}reify#forAll`},log:{implies:`${zi}log#implies`}};
/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Gi;var Hi="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:x):e=>(Gi||(Gi=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)));const{xsd:Wi}=Qi,Vi=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,Ji={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"\t",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},Xi=/[\x00-\x20<>\\"\{\}\|\^\`]/,Zi={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},Ki=/$0^/;class Yi{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._lineMode=!!e.lineMode){this._n3Mode=!1;for(const e in this)!(e in Zi)&&this[e]instanceof RegExp&&(this[e]=Ki)}else this._n3Mode=!1!==e.n3;this._comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,t){let r=this._input;const n=this._comments;for(;;){let s,a;for(;s=this._newline.exec(r);)n&&(a=this._comment.exec(s[0]))&&e(null,{line:this._line,type:"comment",value:a[1],prefix:""}),r=r.substr(s[0].length,r.length),this._line++;if(!s&&(s=this._whitespace.exec(r))&&(r=r.substr(s[0].length,r.length)),this._endOfFile.test(r))return t&&(n&&(a=this._comment.exec(r))&&e(null,{line:this._line,type:"comment",value:a[1],prefix:""}),e(r=null,{line:this._line,type:"eof",value:"",prefix:""})),this._input=r;const o=this._line,u=r[0];let c="",l="",d="",h=null,f=0,p=!1;switch(u){case"^":if(r.length<3)break;if("^"!==r[1]){this._n3Mode&&(f=1,c="^");break}if(this._previousMarker="^^",r=r.substr(2),"<"!==r[0]){p=!0;break}case"<":if(h=this._unescapedIri.exec(r))c="IRI",l=h[1];else if(h=this._iri.exec(r)){if(l=this._unescape(h[1]),null===l||Xi.test(l))return i(this);c="IRI"}else r.length>1&&"<"===r[1]?(c="<<",f=2):this._n3Mode&&r.length>1&&"="===r[1]&&(c="inverse",f=2,l=">");break;case">":r.length>1&&">"===r[1]&&(c=">>",f=2);break;case"_":((h=this._blank.exec(r))||t&&(h=this._blank.exec(`${r} `)))&&(c="blank",d="_",l=h[1]);break;case'"':if(h=this._simpleQuotedString.exec(r))l=h[1];else if(({value:l,matchLength:f}=this._parseLiteral(r)),null===l)return i(this);null===h&&0===f||(c="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(h=this._simpleApostropheString.exec(r))l=h[1];else if(({value:l,matchLength:f}=this._parseLiteral(r)),null===l)return i(this);null===h&&0===f||(c="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(h=this._variable.exec(r))&&(c="var",l=h[0]);break;case"@":"literal"===this._previousMarker&&(h=this._langcode.exec(r))?(c="langcode",l=h[1]):(h=this._keyword.exec(r))&&(c=h[0]);break;case".":if(1===r.length?t:r[1]<"0"||r[1]>"9"){c=".",f=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(h=this._number.exec(r)||t&&(h=this._number.exec(`${r} `)))&&(c="literal",l=h[0],d="string"==typeof h[1]?Wi.double:"string"==typeof h[2]?Wi.decimal:Wi.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(h=this._sparqlKeyword.exec(r))?c=h[0].toUpperCase():p=!0;break;case"f":case"t":(h=this._boolean.exec(r))?(c="literal",l=h[0],d=Wi.boolean):p=!0;break;case"a":(h=this._shortPredicates.exec(r))?(c="abbreviation",l="a"):p=!0;break;case"=":this._n3Mode&&r.length>1&&(c="abbreviation",">"!==r[1]?(f=1,l="="):(f=2,l=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":this._lineMode||(f=1,c=u);break;default:p=!0}if(p&&("@prefix"!==this._previousMarker&&"PREFIX"!==this._previousMarker||!(h=this._prefix.exec(r))?((h=this._prefixed.exec(r))||t&&(h=this._prefixed.exec(`${r} `)))&&(c="prefixed",d=h[1]||"",l=this._unescape(h[2])):(c="prefix",l=h[1]||"")),"^^"===this._previousMarker)switch(c){case"prefixed":c="type";break;case"IRI":c="typeIRI";break;default:c=""}if(!c)return t||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?i(this):this._input=r;const b={line:o,type:c,value:l,prefix:d};e(null,b),this.previousToken=b,this._previousMarker=c,r=r.substr(f||h[0].length,r.length)}function i(t){e(t._syntaxError(/^\S*/.exec(r)[0]))}}_unescape(e){let t=!1;const r=e.replace(Vi,((e,r,n,i)=>{if("string"==typeof r)return String.fromCharCode(Number.parseInt(r,16));if("string"==typeof n){let e=Number.parseInt(n,16);return e<=65535?String.fromCharCode(Number.parseInt(n,16)):String.fromCharCode(55296+((e-=65536)>>10),56320+(1023&e))}return i in Ji?Ji[i]:(t=!0,"")}));return t?null:r}_parseLiteral(e){if(e.length>=3){const t=e.match(/^(?:"""|"|'''|'|)/)[0],r=t.length;let n=Math.max(this._literalClosingPos,r);for(;(n=e.indexOf(t,n))>0;){let t=0;for(;"\\"===e[n-t-1];)t++;if(t%2==0){const t=e.substring(r,n),i=t.split(/\r\n|\r|\n/).length-1,s=n+r;if(1===r&&0!==i||3===r&&this._lineMode)break;return this._line+=i,{value:this._unescape(t),matchLength:s}}n++}this._literalClosingPos=e.length-r+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;const t=new Error(`Unexpected "${e}" on line ${this._line}.`);return t.context={token:void 0,line:this._line,previousToken:this.previousToken},t}_readStartingBom(e){return e.startsWith("\ufeff")?e.substr(1):e}tokenize(e,t){if(this._line=1,"string"==typeof e){if(this._input=this._readStartingBom(e),"function"!=typeof t){const e=[];let t;if(this._tokenizeToEnd(((r,n)=>r?t=r:e.push(n)),!0),t)throw t;return e}Hi((()=>this._tokenizeToEnd(t,!0)))}else this._pendingBuffer=null,"function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",(e=>{null!==this._input&&0!==e.length&&(this._pendingBuffer&&(e=Buffer.concat([this._pendingBuffer,e]),this._pendingBuffer=null),128&e[e.length-1]?this._pendingBuffer=e:(void 0===this._input?this._input=this._readStartingBom("string"==typeof e?e:e.toString()):this._input+=e,this._tokenizeToEnd(t,!1)))})),e.on("end",(()=>{"string"==typeof this._input&&this._tokenizeToEnd(t,!0)})),e.on("error",t)}}function es(e){return!!e&&"DefaultGraph"===e.termType}function ts(e,t){const r=Object.create(null);for(const t in e)n(t,e[t]);function n(e,n){if("string"==typeof n){const i=Object.create(null);r[e]=e=>i[e]||(i[e]=t.namedNode(n+e))}else if(!(e in r))throw new Error(`Unknown prefix: ${e}`);return r[e]}return t=t||ls,n}var rs=Object.freeze({__proto__:null,isNamedNode:function(e){return!!e&&"NamedNode"===e.termType},isBlankNode:function(e){return!!e&&"BlankNode"===e.termType},isLiteral:function(e){return!!e&&"Literal"===e.termType},isVariable:function(e){return!!e&&"Variable"===e.termType},isDefaultGraph:es,inDefaultGraph:function(e){return es(e.graph)},prefix:function(e,t){return ts({"":e},t)("")},prefixes:ts});const{rdf:ns,xsd:is}=Qi;let ss,as=0;const os=/^"(.*".*)(?="[^"]*$)/,us=/^<<("(?:""|[^"])*"[^ ]*|[^ ]+) ("(?:""|[^"])*"[^ ]*|[^ ]+) ("(?:""|[^"])*"[^ ]*|[^ ]+) ?("(?:""|[^"])*"[^ ]*|[^ ]+)?>>$/,cs={namedNode:function(e){return new hs(e)},blankNode:function(e){return new ps(e||"n3-"+as++)},variable:function(e){return new bs(e)},literal:function(e,t){if("string"==typeof t)return new fs(`"${e}"@${t.toLowerCase()}`);let r=t?t.value:"";""===r&&("boolean"==typeof e?r=is.boolean:"number"==typeof e&&(Number.isFinite(e)?r=Number.isInteger(e)?is.integer:is.double:(r=is.double,Number.isNaN(e)||(e=e>0?"INF":"-INF"))));return""===r||r===is.string?new fs(`"${e}"`):new fs(`"${e}"^^${r}`)},defaultGraph:function(){return ss},quad:js,triple:js};var ls=cs;class ds{constructor(e){this.id=e}get value(){return this.id}get hashCode(){return 0}equals(e){return e instanceof ds?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}toJSON(){return{termType:this.termType,value:this.value}}}class hs extends ds{get termType(){return"NamedNode"}}class fs extends ds{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){const e=this.id;let t=e.lastIndexOf('"')+1;return t<e.length&&"@"===e[t++]?e.substr(t).toLowerCase():""}get datatype(){return new hs(this.datatypeString)}get datatypeString(){const e=this.id,t=e.lastIndexOf('"')+1,r=t<e.length?e[t]:"";return"^"===r?e.substr(t+2):"@"!==r?is.string:ns.langString}equals(e){return e instanceof fs?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}}class ps extends ds{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}}class bs extends ds{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}}class gs extends ds{constructor(){return super(""),ss||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}}function _s(e,t){if(t=t||cs,!e)return t.defaultGraph();switch(e[0]){case"?":return t.variable(e.substr(1));case"_":return t.blankNode(e.substr(2));case'"':if(t===cs)return new fs(e);if('"'===e[e.length-1])return t.literal(e.substr(1,e.length-2));const r=e.lastIndexOf('"',e.length-1);return t.literal(e.substr(1,r-1),"@"===e[r+1]?e.substr(r+2):t.namedNode(e.substr(r+3)));case"<":const n=us.exec(e);return t.quad(_s(ws(n[1]),t),_s(ws(n[2]),t),_s(ws(n[3]),t),n[4]&&_s(ws(n[4]),t));default:return t.namedNode(e)}}function ys(e){if("string"==typeof e)return e;if(e instanceof ds&&"Quad"!==e.termType)return e.id;if(!e)return ss.id;switch(e.termType){case"NamedNode":return e.value;case"BlankNode":return`_:${e.value}`;case"Variable":return`?${e.value}`;case"DefaultGraph":return"";case"Literal":return`"${e.value}"${e.language?`@${e.language}`:e.datatype&&e.datatype.value!==is.string?`^^${e.datatype.value}`:""}`;case"Quad":return`<<${vs(ys(e.subject))} ${vs(ys(e.predicate))} ${vs(ys(e.object))}${es(e.graph)?"":` ${ys(e.graph)}`}>>`;default:throw new Error(`Unexpected termType: ${e.termType}`)}}ss=new gs;class ms extends ds{constructor(e,t,r,n){super(""),this._subject=e,this._predicate=t,this._object=r,this._graph=n||ss}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}}function vs(e){return e.replace(os,((e,t)=>`"${t.replace(/"/g,'""')}`))}function ws(e){return e.replace(os,((e,t)=>`"${t.replace(/""/g,'"')}`))}function js(e,t,r,n){return new ms(e,t,r,n)}let xs=0;class Ss{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&Rs(this,e.factory);const t="string"==typeof e.format?e.format.match(/\w*$/)[0].toLowerCase():"",r=/turtle/.test(t),n=/trig/.test(t),i=/triple/.test(t),s=/quad/.test(t),a=this._n3Mode=/n3/.test(t),o=i||s;(this._supportsNamedGraphs=!(r||a))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(r||n||i||a),this._supportsRDFStar=""===t||/star|\*$/.test(t),o&&(this._resolveRelativeIRI=e=>null),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new Yi({lineMode:o,n3:a}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){xs=0}_setBase(e){if(e){const t=e.indexOf("#");t>=0&&(e=e.substr(0,t)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}else this._base="",this._basePath=""}_saveContext(e,t,r,n,i){const s=this._n3Mode;this._contextStack.push({subject:r,predicate:n,object:i,graph:t,type:e,inverse:!!s&&this._inversePredicate,blankPrefix:s?this._prefixes._:"",quantified:s?this._quantified:null}),s&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.id.substr(2)}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(){const e=this._contextStack.pop(),t=this._n3Mode;this._subject=e.subject,this._predicate=e.predicate,this._object=e.object,this._graph=e.graph,t&&(this._inversePredicate=e.inverse,this._prefixes._=e.blankPrefix,this._quantified=e.quantified)}_readInTopContext(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,t){let r;switch(e.type){case"IRI":case"typeIRI":const t=this._resolveIRI(e.value);if(null===t)return this._error("Invalid IRI",e);r=this._namedNode(t);break;case"type":case"prefixed":const n=this._prefixes[e.prefix];if(void 0===n)return this._error(`Undefined prefix "${e.prefix}:"`,e);r=this._namedNode(n+e.value);break;case"blank":r=this._blankNode(this._prefixes[e.prefix]+e.value);break;case"var":r=this._variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!t&&this._n3Mode&&r.id in this._quantified&&(r=this._quantified[r.id]),r}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier=this._blankNode,this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier=this._variable,this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(0===e.prefix.length)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._literal(e.value,this._namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if(void 0===(this._subject=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){const t=e.type;switch(t){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return null===this._predicate?this._error(`Unexpected ${t}`,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return null!==this._predicate?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if(void 0===(this._predicate=this._readEntity(e)))return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(0===e.prefix.length)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._literal(e.value,this._namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if(void 0===(this._object=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return"{"!==e.type?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._emit(this._subject,this._predicate,this._object,this._graph);const t=null===this._predicate;return this._restoreContext(),null!==this._object?this._getContextEndReader():null!==this._predicate?this._readObject:t?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let t=null,r=null,n=this._readListItem;const i=this._subject,s=this._contextStack,a=s[s.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,r=this._blankNode(),this.RDF_FIRST,this._subject=t=this._blankNode()),n=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,r=this._blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext(),0!==s.length&&"list"===s[s.length-1].type&&this._emit(this._subject,this._predicate,this._object,this._graph),null===this._predicate){if(n=this._readPredicate,this._subject===this.RDF_NIL)return n}else if(n=this._getContextEndReader(),this._object===this.RDF_NIL)return n;r=this.RDF_NIL;break;case"literal":0===e.prefix.length?(this._literalValue=e.value,n=this._readListItemDataTypeOrLang):(t=this._literal(e.value,this._namedNode(e.prefix)),n=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if(void 0===(t=this._readEntity(e)))return}if(null===r&&(this._subject=r=this._blankNode()),null===i?null===a.predicate?a.subject=r:a.object=r:this._emit(i,this.RDF_REST,r,this._graph),null!==t){if(this._n3Mode&&("IRI"===e.type||"prefixed"===e.type))return this._saveContext("item",this._graph,r,this.RDF_FIRST,t),this._subject=t,this._predicate=null,this._getPathReader(this._readListItem);this._emit(r,this.RDF_FIRST,t,this._graph)}return n}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let t=this._literal(this._literalValue);switch(e.type){case"type":case"typeIRI":const r=this._readEntity(e);if(void 0===r)return;t=this._literal(this._literalValue,r),e=null;break;case"langcode":t=this._literal(this._literalValue,e.value),e=null}return{token:e,literal:t}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,t){const r=this._completeLiteral(e);if(r)return this._object=r.literal,t&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),null===r.token?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(r.token))}_readFormulaTail(e){return"}"!==e.type?this._readPunctuation(e):(null!==this._subject&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext(),null===this._object?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let t,r=this._graph;const n=this._subject,i=this._inversePredicate;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,t=this._contextStack.length?this._readSubject:this._readInTopContext,i&&(this._inversePredicate=!1);break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:if(this._supportsQuads&&null===this._graph&&void 0!==(r=this._readEntity(e))){t=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(null!==n){const e=this._predicate,t=this._object;i?this._emit(t,e,n,r):this._emit(n,e,t,r)}return t}_readBlankNodePunctuation(e){let t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),t}_readQuadPunctuation(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if("IRI"!==e.type)return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);const t=this._readEntity(e);return this._prefixes[this._prefix]=t.value,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation}_readBaseIRI(e){const t="IRI"===e.type&&this._resolveIRI(e.value);return t?(this._setBase(t),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject=this._blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let t;switch(e.type){case"IRI":case"prefixed":if(void 0!==(t=this._readEntity(e,!0)))break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(null===this._subject?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,t,this.QUANTIFIERS_GRAPH)):this._quantified[t.id]=this._quantifier(this._blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return","===e.type?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:const t=this._contextStack,r=t.length&&t[t.length-1];if(r&&"item"===r.type){const e=this._subject;this._restoreContext(),this._emit(this._subject,this.RDF_FIRST,e,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let t,r;const n=this._blankNode();if(void 0!==(r=this._readEntity(e)))return null===this._predicate?(t=this._subject,this._subject=n):(t=this._object,this._object=n),this._emit(t,r,n,this._graph),this._readPath}_readBackwardPath(e){const t=this._blankNode();let r,n;if(void 0!==(r=this._readEntity(e)))return null===this._predicate?(n=this._subject,this._subject=t):(n=this._object,this._object=t),this._emit(t,r,n,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return">>"!==e.type?this._supportsQuads&&null===this._graph&&void 0!==(this._graph=this._readEntity(e))?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(">>"!==e.type)return this._error(`Expected >> but got ${e.type}`,e);const t=this._quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext(),null===this._subject?(this._subject=t,this._readPredicate):(this._object=t,this._getContextEndReader())}_getContextEndReader(){const e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,t,r,n){this._callback(null,this._quad(e,t,r,n||this.DEFAULTGRAPH))}_error(e,t){const r=new Error(`${e} on line ${t.line}.`);r.context={token:t,line:t.line,previousToken:this._lexer.previousToken},this._callback(r),this._callback=Os}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return("/"===e[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;const t=e.length;let r="",n=-1,i=-1,s=0,a="/";for(;n<t;){switch(a){case":":if(i<0&&"/"===e[++n]&&"/"===e[++n])for(;(i=n+1)<t&&"/"!==e[i];)n=i;break;case"?":case"#":n=t;break;case"/":if("."===e[n+1])switch(a=e[1+ ++n],a){case"/":r+=e.substring(s,n-1),s=n+1;break;case void 0:case"?":case"#":return r+e.substring(s,n)+e.substr(n+1);case".":if(a=e[1+ ++n],void 0===a||"/"===a||"?"===a||"#"===a){if(r+=e.substring(s,n-2),(s=r.lastIndexOf("/"))>=i&&(r=r.substr(0,s)),"/"!==a)return`${r}/${e.substr(n+1)}`;s=n+1}}}a=e[++n]}return r+e.substring(s)}parse(e,t,r){if(this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${xs++}_`,this._prefixCallback=r||Os,this._inversePredicate=!1,this._quantified=Object.create(null),!t){const t=[];let r;if(this._callback=(e,n)=>{e?r=e:n&&t.push(n)},this._lexer.tokenize(e).every((e=>this._readCallback=this._readCallback(e))),r)throw r;return t}this._callback=t,this._lexer.tokenize(e,((e,t)=>{null!==e?(this._callback(e),this._callback=Os):this._readCallback&&(this._readCallback=this._readCallback(t))}))}}function Os(){}function Rs(e,t){const r=t.namedNode;e._namedNode=r,e._blankNode=t.blankNode,e._literal=t.literal,e._variable=t.variable,e._quad=t.quad,e.DEFAULTGRAPH=t.defaultGraph(),e.RDF_FIRST=r(Qi.rdf.first),e.RDF_REST=r(Qi.rdf.rest),e.RDF_NIL=r(Qi.rdf.nil),e.N3_FORALL=r(Qi.r.forAll),e.N3_FORSOME=r(Qi.r.forSome),e.ABBREVIATIONS={a:r(Qi.rdf.type),"=":r(Qi.owl.sameAs),">":r(Qi.log.implies)},e.QUANTIFIERS_GRAPH=r("urn:n3:quantifiers")}Rs(Ss.prototype,ls);const Ts=ls.defaultGraph(),{rdf:ks,xsd:Es}=Qi,Is=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,Ns=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,As={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};class Cs extends ds{equals(){return!1}}class Ps{constructor(e,t){if(this._prefixRegex=/$0^/,e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},this._lists=t.lists,e)this._outputStream=e,this._endStream=void 0===t.end||!!t.end;else{let e="";this._outputStream={write(t,r,n){e+=t,n&&n()},end:t=>{t&&t(null,e)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(t.format)?(this._lineMode=!0,this._writeQuad=this._writeQuadLine):(this._lineMode=!1,this._graph=Ts,this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes),t.baseIRI&&(this._baseMatcher=new RegExp(`^${$s(t.baseIRI)}${t.baseIRI.endsWith("/")?"":"[#?]"}`),this._baseLength=t.baseIRI.length))}get _inDefaultGraph(){return Ts.equals(this._graph)}_write(e,t){this._outputStream.write(e,"utf8",t)}_writeQuad(e,t,r,n,i){try{n.equals(this._graph)||(this._write((null===this._subject?"":this._inDefaultGraph?".\n":"\n}\n")+(Ts.equals(n)?"":`${this._encodeIriOrBlank(n)} {\n`)),this._graph=n,this._subject=null),e.equals(this._subject)?t.equals(this._predicate)?this._write(`, ${this._encodeObject(r)}`,i):this._write(`;\n    ${this._encodePredicate(this._predicate=t)} ${this._encodeObject(r)}`,i):this._write(`${(null===this._subject?"":".\n")+this._encodeSubject(this._subject=e)} ${this._encodePredicate(this._predicate=t)} ${this._encodeObject(r)}`,i)}catch(e){i&&i(e)}}_writeQuadLine(e,t,r,n,i){delete this._prefixMatch,this._write(this.quadToString(e,t,r,n),i)}quadToString(e,t,r,n){return`${this._encodeSubject(e)} ${this._encodeIriOrBlank(t)} ${this._encodeObject(r)}${n&&n.value?` ${this._encodeIriOrBlank(n)} .\n`:" .\n"}`}quadsToString(e){return e.map((e=>this.quadToString(e.subject,e.predicate,e.object,e.graph))).join("")}_encodeSubject(e){return"Quad"===e.termType?this._encodeQuad(e):this._encodeIriOrBlank(e)}_encodeIriOrBlank(e){if("NamedNode"!==e.termType)return this._lists&&e.value in this._lists&&(e=this.list(this._lists[e.value])),"id"in e?e.id:`_:${e.value}`;let t=e.value;this._baseMatcher&&this._baseMatcher.test(t)&&(t=t.substr(this._baseLength)),Is.test(t)&&(t=t.replace(Ns,Ls));const r=this._prefixRegex.exec(t);return r?r[1]?this._prefixIRIs[r[1]]+r[2]:t:`<${t}>`}_encodeLiteral(e){let t=e.value;if(Is.test(t)&&(t=t.replace(Ns,Ls)),e.language)return`"${t}"@${e.language}`;if(this._lineMode){if(e.datatype.value===Es.string)return`"${t}"`}else switch(e.datatype.value){case Es.string:return`"${t}"`;case Es.boolean:if("true"===t||"false"===t)return t;break;case Es.integer:if(/^[+-]?\d+$/.test(t))return t;break;case Es.decimal:if(/^[+-]?\d*\.\d+$/.test(t))return t;break;case Es.double:if(/^[+-]?(?:\d+\.\d*|\.?\d+)[eE][+-]?\d+$/.test(t))return t}return`"${t}"^^${this._encodeIriOrBlank(e.datatype)}`}_encodePredicate(e){return e.value===ks.type?"a":this._encodeIriOrBlank(e)}_encodeObject(e){switch(e.termType){case"Quad":return this._encodeQuad(e);case"Literal":return this._encodeLiteral(e);default:return this._encodeIriOrBlank(e)}}_encodeQuad({subject:e,predicate:t,object:r,graph:n}){return`<<${this._encodeSubject(e)} ${this._encodePredicate(t)} ${this._encodeObject(r)}${es(n)?"":` ${this._encodeIriOrBlank(n)}`}>>`}_blockedWrite(){throw new Error("Cannot write because the writer has been closed.")}addQuad(e,t,r,n,i){void 0===r?this._writeQuad(e.subject,e.predicate,e.object,e.graph,t):"function"==typeof n?this._writeQuad(e,t,r,Ts,n):this._writeQuad(e,t,r,n||Ts,i)}addQuads(e){for(let t=0;t<e.length;t++)this.addQuad(e[t])}addPrefix(e,t,r){const n={};n[e]=t,this.addPrefixes(n,r)}addPrefixes(e,t){if(!this._prefixIRIs)return t&&t();let r=!1;for(let t in e){let n=e[t];"string"!=typeof n&&(n=n.value),r=!0,null!==this._subject&&(this._write(this._inDefaultGraph?".\n":"\n}\n"),this._subject=null,this._graph=""),this._prefixIRIs[n]=t+=":",this._write(`@prefix ${t} <${n}>.\n`)}if(r){let e="",t="";for(const r in this._prefixIRIs)e+=e?`|${r}`:r,t+=(t?"|":"")+this._prefixIRIs[r];e=$s(e),this._prefixRegex=new RegExp(`^(?:${t})[^/]*$|^(${e})([a-zA-Z][\\-_a-zA-Z0-9]*)$`)}this._write(r?"\n":"",t)}blank(e,t){let r,n,i=e;switch(void 0===e?i=[]:e.termType?i=[{predicate:e,object:t}]:"length"in e||(i=[e]),n=i.length){case 0:return new Cs("[]");case 1:if(r=i[0],!(r.object instanceof Cs))return new Cs(`[ ${this._encodePredicate(r.predicate)} ${this._encodeObject(r.object)} ]`);default:let t="[";for(let s=0;s<n;s++)r=i[s],r.predicate.equals(e)?t+=`, ${this._encodeObject(r.object)}`:(t+=`${(s?";\n  ":"\n  ")+this._encodePredicate(r.predicate)} ${this._encodeObject(r.object)}`,e=r.predicate);return new Cs(`${t}\n]`)}}list(e){const t=e&&e.length||0,r=new Array(t);for(let n=0;n<t;n++)r[n]=this._encodeObject(e[n]);return new Cs(`(${r.join(" ")})`)}end(e){null!==this._subject&&(this._write(this._inDefaultGraph?".\n":"\n}\n"),this._subject=null),this._write=this._blockedWrite;let t=e&&((r,n)=>{t=null,e(r,n)});if(this._endStream)try{return this._outputStream.end(t)}catch(e){}t&&t()}}function Ls(e){let t=As[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}function $s(e){return e.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&")}var Ds={exports:{}},Ms=e;function Bs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fs(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Us(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var qs=a.Buffer,zs=o.inspect,Qs=zs&&zs.custom||"inspect";var Gs=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r,n;return t=e,r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return qs.alloc(0);for(var t,r,n,i=qs.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,r=i,n=a,qs.prototype.copy.call(t,r,n),a+=s.data.length,s=s.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,s=e>i.length?i.length:e;if(s===i.length?n+=i:n+=i.slice(0,e),0==(e-=s)){s===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(s));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=qs.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,s),0==(e-=s)){s===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(s));break}++n}return this.length-=n,t}},{key:Qs,value:function(e,t){return zs(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Bs(Object(r),!0).forEach((function(t){Fs(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],r&&Us(t.prototype,r),n&&Us(t,n),e}();function Hs(e,t){Vs(e,t),Ws(e)}function Ws(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function Vs(e,t){e.emit("error",t)}var Js={destroy:function(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Vs,this,e)):process.nextTick(Vs,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?r._writableState?r._writableState.errorEmitted?process.nextTick(Ws,r):(r._writableState.errorEmitted=!0,process.nextTick(Hs,r,e)):process.nextTick(Hs,r,e):t?(process.nextTick(Ws,r),t(e)):process.nextTick(Ws,r)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}},Xs={};const Zs={};function Ks(e,t,r){r||(r=Error);class n extends r{constructor(e,r,n){super(function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(e,r,n))}}n.prototype.name=r.name,n.prototype.code=e,Zs[e]=n}function Ys(e,t){if(Array.isArray(e)){const r=e.length;return e=e.map((e=>String(e))),r>2?`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]:2===r?`one of ${t} ${e[0]} or ${e[1]}`:`of ${t} ${e[0]}`}return`of ${t} ${String(e)}`}Ks("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),Ks("ERR_INVALID_ARG_TYPE",(function(e,t,r){let n;var i,s;let a;if("string"==typeof t&&(i="not ",t.substr(!s||s<0?0:+s,i.length)===i)?(n="must not be",t=t.replace(/^not /,"")):n="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))a=`The ${e} ${n} ${Ys(t,"type")}`;else{const r=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";a=`The "${e}" ${r} ${n} ${Ys(t,"type")}`}return a+=". Received type "+typeof r,a}),TypeError),Ks("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),Ks("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),Ks("ERR_STREAM_PREMATURE_CLOSE","Premature close"),Ks("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),Ks("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),Ks("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),Ks("ERR_STREAM_WRITE_AFTER_END","write after end"),Ks("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),Ks("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),Ks("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),Xs.codes=Zs;var ea=Xs.codes.ERR_INVALID_OPT_VALUE;var ta={getHighWaterMark:function(e,t,r,n){var i=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,n,r);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new ea(n?r:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}},ra={exports:{}},na={exports:{}};"function"==typeof Object.create?na.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:na.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}};try{var ia=require("util");if("function"!=typeof ia.inherits)throw"";ra.exports=ia.inherits}catch(e){ra.exports=na.exports}var sa,aa=o.deprecate,oa=ka;function ua(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}ka.WritableState=Ta;var ca={deprecate:aa},la=Ms,da=a.Buffer,ha=x.Uint8Array||function(){};var fa,pa=Js,ba=ta.getHighWaterMark,ga=Xs.codes,_a=ga.ERR_INVALID_ARG_TYPE,ya=ga.ERR_METHOD_NOT_IMPLEMENTED,ma=ga.ERR_MULTIPLE_CALLBACK,va=ga.ERR_STREAM_CANNOT_PIPE,wa=ga.ERR_STREAM_DESTROYED,ja=ga.ERR_STREAM_NULL_VALUES,xa=ga.ERR_STREAM_WRITE_AFTER_END,Sa=ga.ERR_UNKNOWN_ENCODING,Oa=pa.errorOrDestroy;function Ra(){}function Ta(e,t,r){sa=sa||$a,e=e||{},"boolean"!=typeof r&&(r=t instanceof sa),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=ba(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if("function"!=typeof i)throw new ma;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(process.nextTick(i,n),process.nextTick(Pa,e,t),e._writableState.errorEmitted=!0,Oa(e,n)):(i(n),e._writableState.errorEmitted=!0,Oa(e,n),Pa(e,t))}(e,r,n,t,i);else{var s=Aa(r)||e.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||Na(e,r),n?process.nextTick(Ia,e,r,s,i):Ia(e,r,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new ua(this)}function ka(e){var t=this instanceof(sa=sa||$a);if(!t&&!fa.call(ka,this))return new ka(e);this._writableState=new Ta(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),la.call(this)}function Ea(e,t,r,n,i,s,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new wa("write")):r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function Ia(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),Pa(e,t)}function Na(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var a=0,o=!0;r;)i[a]=r,r.isBuf||(o=!1),r=r.next,a+=1;i.allBuffers=o,Ea(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new ua(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,l=r.callback;if(Ea(e,t,!1,t.objectMode?1:u.length,u,c,l),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function Aa(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function Ca(e,t){e._final((function(r){t.pendingcb--,r&&Oa(e,r),t.prefinished=!0,e.emit("prefinish"),Pa(e,t)}))}function Pa(e,t){var r=Aa(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,process.nextTick(Ca,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}ra.exports(ka,la),Ta.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(Ta.prototype,"buffer",{get:ca.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(fa=Function.prototype[Symbol.hasInstance],Object.defineProperty(ka,Symbol.hasInstance,{value:function(e){return!!fa.call(this,e)||this===ka&&(e&&e._writableState instanceof Ta)}})):fa=function(e){return e instanceof this},ka.prototype.pipe=function(){Oa(this,new va)},ka.prototype.write=function(e,t,r){var n,i=this._writableState,s=!1,a=!i.objectMode&&(n=e,da.isBuffer(n)||n instanceof ha);return a&&!da.isBuffer(e)&&(e=function(e){return da.from(e)}(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=Ra),i.ending?function(e,t){var r=new xa;Oa(e,r),process.nextTick(t,r)}(this,r):(a||function(e,t,r,n){var i;return null===r?i=new ja:"string"==typeof r||t.objectMode||(i=new _a("chunk",["string","Buffer"],r)),!i||(Oa(e,i),process.nextTick(n,i),!1)}(this,i,e,r))&&(i.pendingcb++,s=function(e,t,r,n,i,s){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=da.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var o=t.objectMode?1:n.length;t.length+=o;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Ea(e,t,!1,o,n,i,s);return u}(this,i,a,e,t,r)),s},ka.prototype.cork=function(){this._writableState.corked++},ka.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||Na(this,e))},ka.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new Sa(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(ka.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(ka.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),ka.prototype._write=function(e,t,r){r(new ya("_write()"))},ka.prototype._writev=null,ka.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||function(e,t,r){t.ending=!0,Pa(e,t),r&&(t.finished?process.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r),this},Object.defineProperty(ka.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(ka.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),ka.prototype.destroy=pa.destroy,ka.prototype._undestroy=pa.undestroy,ka.prototype._destroy=function(e,t){t(e)};var La=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},$a=qa,Da=No,Ma=oa;ra.exports(qa,Da);for(var Ba=La(Ma.prototype),Fa=0;Fa<Ba.length;Fa++){var Ua=Ba[Fa];qa.prototype[Ua]||(qa.prototype[Ua]=Ma.prototype[Ua])}function qa(e){if(!(this instanceof qa))return new qa(e);Da.call(this,e),Ma.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",za)))}function za(){this._writableState.ended||process.nextTick(Qa,this)}function Qa(e){e.end()}Object.defineProperty(qa.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(qa.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(qa.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(qa.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}});var Ga={},Ha={exports:{}};
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
!function(e,t){var r=a,n=r.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=s),s.prototype=Object.create(n.prototype),i(n,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=n(e);return void 0!==t?"string"==typeof r?i.fill(t,r):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}(Ha,Ha.exports);var Wa=Ha.exports.Buffer,Va=Wa.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Ja(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(Wa.isEncoding===Va||!Va(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=Ka,this.end=Ya,t=4;break;case"utf8":this.fillLast=Za,t=4;break;case"base64":this.text=eo,this.end=to,t=3;break;default:return this.write=ro,void(this.end=no)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Wa.allocUnsafe(t)}function Xa(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function Za(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"ï¿½";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"ï¿½";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"ï¿½"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function Ka(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function Ya(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function eo(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function to(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function ro(e){return e.toString(this.encoding)}function no(e){return e&&e.length?this.write(e):""}Ga.StringDecoder=Ja,Ja.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},Ja.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"ï¿½":t},Ja.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=Xa(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=Xa(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=Xa(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},Ja.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};var io=Xs.codes.ERR_STREAM_PREMATURE_CLOSE;function so(){}var ao,oo=function e(t,r,n){if("function"==typeof r)return e(t,null,r);r||(r={}),n=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(n||so);var i=r.readable||!1!==r.readable&&t.readable,s=r.writable||!1!==r.writable&&t.writable,a=function(){t.writable||u()},o=t._writableState&&t._writableState.finished,u=function(){s=!1,o=!0,i||n.call(t)},c=t._readableState&&t._readableState.endEmitted,l=function(){i=!1,c=!0,s||n.call(t)},d=function(e){n.call(t,e)},h=function(){var e;return i&&!c?(t._readableState&&t._readableState.ended||(e=new io),n.call(t,e)):s&&!o?(t._writableState&&t._writableState.ended||(e=new io),n.call(t,e)):void 0},f=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?s&&!t._writableState&&(t.on("end",a),t.on("close",a)):(t.on("complete",u),t.on("abort",h),t.req?f():t.on("request",f)),t.on("end",l),t.on("finish",u),!1!==r.error&&t.on("error",d),t.on("close",h),function(){t.removeListener("complete",u),t.removeListener("abort",h),t.removeListener("request",f),t.req&&t.req.removeListener("finish",u),t.removeListener("end",a),t.removeListener("close",a),t.removeListener("finish",u),t.removeListener("end",l),t.removeListener("error",d),t.removeListener("close",h)}};function uo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var co=oo,lo=Symbol("lastResolve"),ho=Symbol("lastReject"),fo=Symbol("error"),po=Symbol("ended"),bo=Symbol("lastPromise"),go=Symbol("handlePromise"),_o=Symbol("stream");function yo(e,t){return{value:e,done:t}}function mo(e){var t=e[lo];if(null!==t){var r=e[_o].read();null!==r&&(e[bo]=null,e[lo]=null,e[ho]=null,t(yo(r,!1)))}}function vo(e){process.nextTick(mo,e)}var wo=Object.getPrototypeOf((function(){})),jo=Object.setPrototypeOf((ao={get stream(){return this[_o]},next:function(){var e=this,t=this[fo];if(null!==t)return Promise.reject(t);if(this[po])return Promise.resolve(yo(void 0,!0));if(this[_o].destroyed)return new Promise((function(t,r){process.nextTick((function(){e[fo]?r(e[fo]):t(yo(void 0,!0))}))}));var r,n=this[bo];if(n)r=new Promise(function(e,t){return function(r,n){e.then((function(){t[po]?r(yo(void 0,!0)):t[go](r,n)}),n)}}(n,this));else{var i=this[_o].read();if(null!==i)return Promise.resolve(yo(i,!1));r=new Promise(this[go])}return this[bo]=r,r}},uo(ao,Symbol.asyncIterator,(function(){return this})),uo(ao,"return",(function(){var e=this;return new Promise((function(t,r){e[_o].destroy(null,(function(e){e?r(e):t(yo(void 0,!0))}))}))})),ao),wo),xo=function(e){var t,r=Object.create(jo,(uo(t={},_o,{value:e,writable:!0}),uo(t,lo,{value:null,writable:!0}),uo(t,ho,{value:null,writable:!0}),uo(t,fo,{value:null,writable:!0}),uo(t,po,{value:e._readableState.endEmitted,writable:!0}),uo(t,go,{value:function(e,t){var n=r[_o].read();n?(r[bo]=null,r[lo]=null,r[ho]=null,e(yo(n,!1))):(r[lo]=e,r[ho]=t)},writable:!0}),t));return r[bo]=null,co(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[ho];return null!==t&&(r[bo]=null,r[lo]=null,r[ho]=null,t(e)),void(r[fo]=e)}var n=r[lo];null!==n&&(r[bo]=null,r[lo]=null,r[ho]=null,n(yo(void 0,!0))),r[po]=!0})),e.on("readable",vo.bind(null,r)),r};function So(e,t,r,n,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,i)}function Oo(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function a(e){So(s,n,i,a,o,"next",e)}function o(e){So(s,n,i,a,o,"throw",e)}a(void 0)}))}}function Ro(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function To(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ko=Xs.codes.ERR_INVALID_ARG_TYPE;var Eo,Io=function(e,t,r){var n;if(t&&"function"==typeof t.next)n=t;else if(t&&t[Symbol.asyncIterator])n=t[Symbol.asyncIterator]();else{if(!t||!t[Symbol.iterator])throw new ko("iterable",["Iterable"],t);n=t[Symbol.iterator]()}var i=new e(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ro(Object(r),!0).forEach((function(t){To(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ro(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({objectMode:!0},r)),s=!1;function a(){return o.apply(this,arguments)}function o(){return(o=Oo((function*(){try{var e=yield n.next(),t=e.value;e.done?i.push(null):i.push(yield t)?a():s=!1}catch(e){i.destroy(e)}}))).apply(this,arguments)}return i._read=function(){s||(s=!0,a())},i},No=Ko;Ko.ReadableState=Zo,s.EventEmitter;var Ao=function(e,t){return e.listeners(t).length},Co=Ms,Po=a.Buffer,Lo=x.Uint8Array||function(){};var $o,Do=o;$o=Do&&Do.debuglog?Do.debuglog("stream"):function(){};var Mo,Bo,Fo,Uo=Gs,qo=Js,zo=ta.getHighWaterMark,Qo=Xs.codes,Go=Qo.ERR_INVALID_ARG_TYPE,Ho=Qo.ERR_STREAM_PUSH_AFTER_EOF,Wo=Qo.ERR_METHOD_NOT_IMPLEMENTED,Vo=Qo.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;ra.exports(Ko,Co);var Jo=qo.errorOrDestroy,Xo=["error","close","destroy","pause","resume"];function Zo(e,t,r){Eo=Eo||$a,e=e||{},"boolean"!=typeof r&&(r=t instanceof Eo),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=zo(this,e,"readableHighWaterMark",r),this.buffer=new Uo,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(Mo||(Mo=Ga.StringDecoder),this.decoder=new Mo(e.encoding),this.encoding=e.encoding)}function Ko(e){if(Eo=Eo||$a,!(this instanceof Ko))return new Ko(e);var t=this instanceof Eo;this._readableState=new Zo(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),Co.call(this)}function Yo(e,t,r,n,i){$o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if($o("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?ru(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,nu(e)))}(e,a);else if(i||(s=function(e,t){var r;n=t,Po.isBuffer(n)||n instanceof Lo||"string"==typeof t||void 0===t||e.objectMode||(r=new Go("chunk",["string","Buffer","Uint8Array"],t));var n;return r}(a,t)),s)Jo(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===Po.prototype||(t=function(e){return Po.from(e)}(t)),n)a.endEmitted?Jo(e,new Vo):eu(e,a,t,!0);else if(a.ended)Jo(e,new Ho);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?eu(e,a,t,!1):iu(e,a)):eu(e,a,t,!1)}else n||(a.reading=!1,iu(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function eu(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&ru(e)),iu(e,t)}Object.defineProperty(Ko.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),Ko.prototype.destroy=qo.destroy,Ko.prototype._undestroy=qo.undestroy,Ko.prototype._destroy=function(e,t){t(e)},Ko.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=Po.from(e,t),t=""),r=!0),Yo(this,e,t,!1,r)},Ko.prototype.unshift=function(e){return Yo(this,e,null,!0,!1)},Ko.prototype.isPaused=function(){return!1===this._readableState.flowing},Ko.prototype.setEncoding=function(e){Mo||(Mo=Ga.StringDecoder);var t=new Mo(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};function tu(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=1073741824?e=1073741824:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function ru(e){var t=e._readableState;$o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||($o("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(nu,e))}function nu(e){var t=e._readableState;$o("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,cu(e)}function iu(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(su,e,t))}function su(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if($o("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function au(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function ou(e){$o("readable nexttick read 0"),e.read(0)}function uu(e,t){$o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),cu(e),t.flowing&&!t.reading&&e.read(0)}function cu(e){var t=e._readableState;for($o("flow",t.flowing);t.flowing&&null!==e.read(););}function lu(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function du(e){var t=e._readableState;$o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(hu,t,e))}function hu(e,t){if($o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function fu(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}Ko.prototype.read=function(e){$o("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return $o("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?du(this):ru(this),null;if(0===(e=tu(e,t))&&t.ended)return 0===t.length&&du(this),null;var n,i=t.needReadable;return $o("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&$o("length less than watermark",i=!0),t.ended||t.reading?$o("reading or ended",i=!1):i&&($o("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=tu(r,t))),null===(n=e>0?lu(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&du(this)),null!==n&&this.emit("data",n),n},Ko.prototype._read=function(e){Jo(this,new Wo("_read()"))},Ko.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,$o("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?a:f;function s(t,i){$o("onunpipe"),t===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,$o("cleanup"),e.removeListener("close",d),e.removeListener("finish",h),e.removeListener("drain",o),e.removeListener("error",l),e.removeListener("unpipe",s),r.removeListener("end",a),r.removeListener("end",f),r.removeListener("data",c),u=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||o())}function a(){$o("onend"),e.end()}n.endEmitted?process.nextTick(i):r.once("end",i),e.on("unpipe",s);var o=function(e){return function(){var t=e._readableState;$o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&Ao(e,"data")&&(t.flowing=!0,cu(e))}}(r);e.on("drain",o);var u=!1;function c(t){$o("ondata");var i=e.write(t);$o("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==fu(n.pipes,e))&&!u&&($o("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function l(t){$o("onerror",t),f(),e.removeListener("error",l),0===Ao(e,"error")&&Jo(e,t)}function d(){e.removeListener("finish",h),f()}function h(){$o("onfinish"),e.removeListener("close",d),f()}function f(){$o("unpipe"),r.unpipe(e)}return r.on("data",c),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",l),e.once("close",d),e.once("finish",h),e.emit("pipe",r),n.flowing||($o("pipe resume"),r.resume()),e},Ko.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var a=fu(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},Ko.prototype.on=function(e,t){var r=Co.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===e&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,$o("on readable",n.length,n.reading),n.length?ru(this):n.reading||process.nextTick(ou,this))),r},Ko.prototype.addListener=Ko.prototype.on,Ko.prototype.removeListener=function(e,t){var r=Co.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(au,this),r},Ko.prototype.removeAllListeners=function(e){var t=Co.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(au,this),t},Ko.prototype.resume=function(){var e=this._readableState;return e.flowing||($o("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(uu,e,t))}(this,e)),e.paused=!1,this},Ko.prototype.pause=function(){return $o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&($o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},Ko.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if($o("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){($o("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<Xo.length;s++)e.on(Xo[s],this.emit.bind(this,Xo[s]));return this._read=function(t){$o("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(Ko.prototype[Symbol.asyncIterator]=function(){return void 0===Bo&&(Bo=xo),Bo(this)}),Object.defineProperty(Ko.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Ko.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Ko.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),Ko._fromList=lu,Object.defineProperty(Ko.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(Ko.from=function(e,t){return void 0===Fo&&(Fo=Io),Fo(Ko,e,t)});var pu=ju,bu=Xs.codes,gu=bu.ERR_METHOD_NOT_IMPLEMENTED,_u=bu.ERR_MULTIPLE_CALLBACK,yu=bu.ERR_TRANSFORM_ALREADY_TRANSFORMING,mu=bu.ERR_TRANSFORM_WITH_LENGTH_0,vu=$a;function wu(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new _u);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function ju(e){if(!(this instanceof ju))return new ju(e);vu.call(this,e),this._transformState={afterTransform:wu.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",xu)}function xu(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?Su(this,null,null):this._flush((function(t,r){Su(e,t,r)}))}function Su(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new mu;if(e._transformState.transforming)throw new yu;return e.push(null)}ra.exports(ju,vu),ju.prototype.push=function(e,t){return this._transformState.needTransform=!1,vu.prototype.push.call(this,e,t)},ju.prototype._transform=function(e,t,r){r(new gu("_transform()"))},ju.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},ju.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},ju.prototype._destroy=function(e,t){vu.prototype._destroy.call(this,e,(function(e){t(e)}))};var Ou,Ru=ku,Tu=pu;function ku(e){if(!(this instanceof ku))return new ku(e);Tu.call(this,e)}ra.exports(ku,Tu),ku.prototype._transform=function(e,t,r){r(null,e)};var Eu=Xs.codes,Iu=Eu.ERR_MISSING_ARGS,Nu=Eu.ERR_STREAM_DESTROYED;function Au(e){if(e)throw e}function Cu(e,t,r,n){n=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(n);var i=!1;e.on("close",(function(){i=!0})),void 0===Ou&&(Ou=oo),Ou(e,{readable:t,writable:r},(function(e){if(e)return n(e);i=!0,n()}));var s=!1;return function(t){if(!i&&!s)return s=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void n(t||new Nu("pipe"))}}function Pu(e){e()}function Lu(e,t){return e.pipe(t)}function $u(e){return e.length?"function"!=typeof e[e.length-1]?Au:e.pop():Au}var Du=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=$u(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Iu("streams");var s=t.map((function(e,r){var a=r<t.length-1;return Cu(e,a,r>0,(function(e){n||(n=e),e&&s.forEach(Pu),a||(s.forEach(Pu),i(n))}))}));return t.reduce(Lu)};!function(t,r){var n=e;"disable"===process.env.READABLE_STREAM&&n?(t.exports=n.Readable,Object.assign(t.exports,n),t.exports.Stream=n):((r=t.exports=No).Stream=n||r,r.Readable=r,r.Writable=oa,r.Duplex=$a,r.Transform=pu,r.PassThrough=Ru,r.finished=oo,r.pipeline=Du)}(Ds,Ds.exports);class Mu{constructor(e,t){this._size=0,this._graphs=Object.create(null),this._id=0,this._ids=Object.create(null),this._ids["><"]=0,this._entities=Object.create(null),this._blankNodeIndex=0,t||!e||e[0]||(t=e,e=null),t=t||{},this._factory=t.factory||ls,e&&this.addQuads(e)}get size(){let e=this._size;if(null!==e)return e;e=0;const t=this._graphs;let r,n;for(const i in t)for(const s in r=t[i].subjects)for(const t in n=r[s])e+=Object.keys(n[t]).length;return this._size=e}_addToIndex(e,t,r,n){const i=e[t]||(e[t]={}),s=i[r]||(i[r]={}),a=n in s;return a||(s[n]=null),!a}_removeFromIndex(e,t,r,n){const i=e[t],s=i[r];delete s[n];for(const e in s)return;delete i[r];for(const e in i)return;delete e[t]}_findInIndex(e,t,r,n,i,s,a,o,u,c){let l,d,h;const f=!t+!r+!n>1?Object.keys(this._ids):this._entities;t&&((l=e,e={})[t]=l[t]);for(const t in e){const p=f[t];if(d=e[t]){r&&((l=d,d={})[r]=l[r]);for(const e in d){const t=f[e];if(h=d[e]){const e=n?n in h?[n]:[]:Object.keys(h);for(let r=0;r<e.length;r++){const n={subject:null,predicate:null,object:null};n[i]=_s(p,this._factory),n[s]=_s(t,this._factory),n[a]=_s(f[e[r]],this._factory);const l=this._factory.quad(n.subject,n.predicate,n.object,_s(o,this._factory));if(c)c.push(l);else if(u(l))return!0}}}}}return c}_loop(e,t){for(const r in e)t(r)}_loopByKey0(e,t,r){let n,i;if(n=e[t])for(i in n)r(i)}_loopByKey1(e,t,r){let n,i;for(n in e)i=e[n],i[t]&&r(n)}_loopBy2Keys(e,t,r,n){let i,s,a;if((i=e[t])&&(s=i[r]))for(a in s)n(a)}_countInIndex(e,t,r,n){let i,s,a,o=0;t&&((i=e,e={})[t]=i[t]);for(const t in e)if(s=e[t]){r&&((i=s,s={})[r]=i[r]);for(const e in s)(a=s[e])&&(n?n in a&&o++:o+=Object.keys(a).length)}return o}_getGraphs(e){if(!Bu(e))return this._graphs;const t={};return t[e]=this._graphs[e],t}_uniqueEntities(e){const t=Object.create(null);return r=>{r in t||(t[r]=!0,e(_s(this._entities[r],this._factory)))}}add(e){return this.addQuad(e),this}addQuad(e,t,r,n){t||(n=e.graph,r=e.object,t=e.predicate,e=e.subject),e=ys(e),t=ys(t),r=ys(r),n=ys(n);let i=this._graphs[n];i||(i=this._graphs[n]={subjects:{},predicates:{},objects:{}},Object.freeze(i));const s=this._ids,a=this._entities;e=s[e]||(s[a[++this._id]=e]=this._id),t=s[t]||(s[a[++this._id]=t]=this._id),r=s[r]||(s[a[++this._id]=r]=this._id);const o=this._addToIndex(i.subjects,e,t,r);return this._addToIndex(i.predicates,t,r,e),this._addToIndex(i.objects,r,e,t),this._size=null,o}addQuads(e){for(let t=0;t<e.length;t++)this.addQuad(e[t])}delete(e){return this.removeQuad(e),this}has(e){return 0!==this.getQuads(e.subject,e.predicate,e.object,e.graph).length}import(e){return e.on("data",(e=>{this.addQuad(e)})),e}removeQuad(e,t,r,n){t||(n=e.graph,r=e.object,t=e.predicate,e=e.subject),e=ys(e),t=ys(t),r=ys(r),n=ys(n);const i=this._ids,s=this._graphs;let a,o,u;if(!((e=i[e])&&(t=i[t])&&(r=i[r])&&(a=s[n])&&(o=a.subjects[e])&&(u=o[t])&&r in u))return!1;for(e in this._removeFromIndex(a.subjects,e,t,r),this._removeFromIndex(a.predicates,t,r,e),this._removeFromIndex(a.objects,r,e,t),null!==this._size&&this._size--,a.subjects)return!0;return delete s[n],!0}removeQuads(e){for(let t=0;t<e.length;t++)this.removeQuad(e[t])}remove(e){return e.on("data",(e=>{this.removeQuad(e)})),e}removeMatches(e,t,r,n){const i=new Ds.exports.Readable({objectMode:!0});return i._read=()=>{for(const s of this.getQuads(e,t,r,n))i.push(s);i.push(null)},this.remove(i)}deleteGraph(e){return this.removeMatches(null,null,null,e)}getQuads(e,t,r,n){e=e&&ys(e),t=t&&ys(t),r=r&&ys(r),n=n&&ys(n);const i=[],s=this._getGraphs(n),a=this._ids;let o,u,c,l;if(Bu(e)&&!(u=a[e])||Bu(t)&&!(c=a[t])||Bu(r)&&!(l=a[r]))return i;for(const e in s)(o=s[e])&&(u?l?this._findInIndex(o.objects,l,u,c,"object","subject","predicate",e,null,i):this._findInIndex(o.subjects,u,c,null,"subject","predicate","object",e,null,i):c?this._findInIndex(o.predicates,c,l,null,"predicate","object","subject",e,null,i):l?this._findInIndex(o.objects,l,null,null,"object","subject","predicate",e,null,i):this._findInIndex(o.subjects,null,null,null,"subject","predicate","object",e,null,i));return i}match(e,t,r,n){return new Fu(this,e,t,r,n)}countQuads(e,t,r,n){e=e&&ys(e),t=t&&ys(t),r=r&&ys(r),n=n&&ys(n);const i=this._getGraphs(n),s=this._ids;let a,o,u,c,l=0;if(Bu(e)&&!(o=s[e])||Bu(t)&&!(u=s[t])||Bu(r)&&!(c=s[r]))return 0;for(const n in i)(a=i[n])&&(l+=e?r?this._countInIndex(a.objects,c,o,u):this._countInIndex(a.subjects,o,u,c):t?this._countInIndex(a.predicates,u,c,o):this._countInIndex(a.objects,c,o,u));return l}forEach(e,t,r,n,i){this.some((t=>(e(t),!1)),t,r,n,i)}every(e,t,r,n,i){let s=!1;const a=!this.some((t=>(s=!0,!e(t))),t,r,n,i);return s&&a}some(e,t,r,n,i){t=t&&ys(t),r=r&&ys(r),n=n&&ys(n),i=i&&ys(i);const s=this._getGraphs(i),a=this._ids;let o,u,c,l;if(Bu(t)&&!(u=a[t])||Bu(r)&&!(c=a[r])||Bu(n)&&!(l=a[n]))return!1;for(const t in s)if(o=s[t])if(u){if(l){if(this._findInIndex(o.objects,l,u,c,"object","subject","predicate",t,e,null))return!0}else if(this._findInIndex(o.subjects,u,c,null,"subject","predicate","object",t,e,null))return!0}else if(c){if(this._findInIndex(o.predicates,c,l,null,"predicate","object","subject",t,e,null))return!0}else if(l){if(this._findInIndex(o.objects,l,null,null,"object","subject","predicate",t,e,null))return!0}else if(this._findInIndex(o.subjects,null,null,null,"subject","predicate","object",t,e,null))return!0;return!1}getSubjects(e,t,r){const n=[];return this.forSubjects((e=>{n.push(e)}),e,t,r),n}forSubjects(e,t,r,n){t=t&&ys(t),r=r&&ys(r),n=n&&ys(n);const i=this._ids,s=this._getGraphs(n);let a,o,u;if(e=this._uniqueEntities(e),!(Bu(t)&&!(o=i[t])||Bu(r)&&!(u=i[r])))for(n in s)(a=s[n])&&(o?u?this._loopBy2Keys(a.predicates,o,u,e):this._loopByKey1(a.subjects,o,e):u?this._loopByKey0(a.objects,u,e):this._loop(a.subjects,e))}getPredicates(e,t,r){const n=[];return this.forPredicates((e=>{n.push(e)}),e,t,r),n}forPredicates(e,t,r,n){t=t&&ys(t),r=r&&ys(r),n=n&&ys(n);const i=this._ids,s=this._getGraphs(n);let a,o,u;if(e=this._uniqueEntities(e),!(Bu(t)&&!(o=i[t])||Bu(r)&&!(u=i[r])))for(n in s)(a=s[n])&&(o?u?this._loopBy2Keys(a.objects,u,o,e):this._loopByKey0(a.subjects,o,e):u?this._loopByKey1(a.predicates,u,e):this._loop(a.predicates,e))}getObjects(e,t,r){const n=[];return this.forObjects((e=>{n.push(e)}),e,t,r),n}forObjects(e,t,r,n){t=t&&ys(t),r=r&&ys(r),n=n&&ys(n);const i=this._ids,s=this._getGraphs(n);let a,o,u;if(e=this._uniqueEntities(e),!(Bu(t)&&!(o=i[t])||Bu(r)&&!(u=i[r])))for(n in s)(a=s[n])&&(o?u?this._loopBy2Keys(a.subjects,o,u,e):this._loopByKey1(a.objects,o,e):u?this._loopByKey0(a.predicates,u,e):this._loop(a.objects,e))}getGraphs(e,t,r){const n=[];return this.forGraphs((e=>{n.push(e)}),e,t,r),n}forGraphs(e,t,r,n){for(const i in this._graphs)this.some((t=>(e(t.graph),!0)),t,r,n,i)}createBlankNode(e){let t,r;if(e)for(t=e=`_:${e}`,r=1;this._ids[t];)t=e+r++;else do{t="_:b"+this._blankNodeIndex++}while(this._ids[t]);return this._ids[t]=++this._id,this._entities[this._id]=t,this._factory.blankNode(t.substr(2))}extractLists({remove:e=!1,ignoreErrors:t=!1}={}){const r={},n=t?()=>!0:(e,t)=>{throw new Error(`${e.value} ${t}`)},i=this.getQuads(null,Qi.rdf.rest,Qi.rdf.nil,null),s=e?[...i]:[];return i.forEach((t=>{const i=[];let a,o,u=!1;const c=t.graph;let l=t.subject;for(;l&&!u;){const e=this.getQuads(null,null,l,null),t=this.getQuads(l,null,null,null);let r,d=null,h=null,f=null;for(let i=0;i<t.length&&!u;i++)r=t[i],r.graph.equals(c)?a?u=n(l,"has non-list arcs out"):r.predicate.value===Qi.rdf.first?d?u=n(l,"has multiple rdf:first arcs"):s.push(d=r):r.predicate.value===Qi.rdf.rest?h?u=n(l,"has multiple rdf:rest arcs"):s.push(h=r):e.length?u=n(l,"can't be subject and object"):(a=r,o="subject"):u=n(l,"not confined to single graph");for(let t=0;t<e.length&&!u;++t)r=e[t],a?u=n(l,"can't have coreferences"):r.predicate.value===Qi.rdf.rest?f?u=n(l,"has incoming rdf:rest arcs"):f=r:(a=r,o="object");d?i.unshift(d.object):u=n(l,"has no list head"),l=f&&f.subject}u?e=!1:a&&(r[a[o].value]=i)})),e&&this.removeQuads(s),r}*[Symbol.iterator](){yield*this.getQuads()}}function Bu(e){return"string"==typeof e||e instanceof String}class Fu extends Ds.exports.Readable{constructor(e,t,r,n,i){super({objectMode:!0}),Object.assign(this,{n3Store:e,subject:t,predicate:r,object:n,graph:i})}get filtered(){if(!this._filtered){const{n3Store:e,graph:t,object:r,predicate:n,subject:i}=this,s=e.getQuads(i,n,r,t);this._filtered=new Mu(s,{factory:e._factory})}return this._filtered}get size(){return this.filtered.size}_read(){for(const e of this.filtered.getQuads())this.push(e);this.push(null)}add(e){return this.filtered.add(e)}delete(e){return this.filtered.delete(e)}has(e){return this.filtered.has(e)}match(e,t,r,n){return new Fu(this.filtered,e,t,r,n)}*[Symbol.iterator](){yield*this.filtered.getQuads()}}class Uu extends Ds.exports.Transform{constructor(e){super({decodeStrings:!0}),this._readableState.objectMode=!0;let t,r;new Ss(e).parse({on:(e,n)=>{switch(e){case"data":t=n;break;case"end":r=n}}},((e,t)=>{e&&this.emit("error",e)||t&&this.push(t)}),((e,t)=>{this.emit("prefix",e,t)})),this._transform=(e,r,n)=>{t(e),n()},this._flush=e=>{r(),e()}}import(e){return e.on("data",(e=>{this.write(e)})),e.on("end",(()=>{this.end()})),e.on("error",(e=>{this.emit("error",e)})),this}}class qu extends Ds.exports.Transform{constructor(e){super({encoding:"utf8",writableObjectMode:!0});const t=this._writer=new Ps({write:(e,t,r)=>{this.push(e),r&&r()},end:e=>{this.push(null),e&&e()}},e);this._transform=(e,r,n)=>{t.addQuad(e,n)},this._flush=e=>{t.end(e)}}import(e){return e.on("data",(e=>{this.write(e)})),e.on("end",(()=>{this.end()})),e.on("error",(e=>{this.emit("error",e)})),e.on("prefix",((e,t)=>{this._writer.addPrefix(e,t)})),this}}var zu=Object.freeze({__proto__:null,Lexer:Yi,Parser:Ss,Writer:Ps,Store:Mu,StreamParser:Uu,StreamWriter:qu,Util:rs,DataFactory:ls,Term:ds,NamedNode:hs,Literal:fs,BlankNode:ps,Variable:bs,DefaultGraph:gs,Quad:ms,Triple:ms,termFromId:_s,termToId:ys});export{Mi as Consolid};
//# sourceMappingURL=bundle.esm.min.js.map
